---
title: "Assesment of the conditioned calibration with crossvalidation"
output: 
  html_notebook:
    theme: united
    toc: yes
    toc_depth: 5
---

```{r}
library(devtools)
library(transformeR)
load_all("C:/Users/usuario/Desktop/transformeR")
load_all("C:/Users/usuario/Desktop/downscaleR")
load_all("C:/Users/usuario/Desktop/climate4R.value")
```

```{r}
library(loadeR)
library(climate4R.value)
library(magrittr)
library(evd)
library(formattable) #neccessary to create tables with colors
library(lubridate) #neccessary to calculate differences in years between dates
library(lattice)
library(abind) #necessary to biasCorrectionMod works
library(MASS) 
library(dplyr)
```




```{r}
set.seed(42)

load("C:/Users/usuario/Desktop/TRMM-Calibration/Data/pca.RData")
#load("/media/meteo/TOURO Mobile/work/TRMM-Calibration/Data/pp_reanalysis.RData")
idx.tp <- which(attributes(pca$tp[[1]])$explained_variance >= .75)[1]
idx.msl <- which(attributes(pca$msl[[1]])$explained_variance >= .9)[1]
idx.diff.msl <- which(attributes(pca$diff_msl[[1]])$explained_variance >= .9)[1]

pca.matrix <- cbind(pca$tp[[1]]$PCs[,1:idx.tp],pca$msl[[1]]$PCs[,1:idx.msl],pca$diff_msl[[1]]$PCs[,1:idx.diff.msl])

k = 5
load('C:/Users/usuario/Desktop/TRMM-Calibration/Data/kmModel5.RData')

precip_obs <- loadStationData("C:/Users/usuario/Desktop/TRMM-Calibration/Data/SP_ascii.zip", var = "precip_obs")
precip_trmm <- loadStationData("C:/Users/usuario/Desktop/TRMM-Calibration/Data/SP_ascii.zip", var = "precip_trmm")

```


```{r}
kmModel5$cluster <- kmModel5$cluster[1:8034]

```

```{r}
MaxReturnValue <- function(data){
  #library(lubridate)
  #nyears <- round(time_length(difftime(cal.madrid.eqm$Dates$end[length(cal.madrid.eqm$Dates$end)], cal.madrid.eqm$Dates$start[1]),"years"))
  nyears <- 20
  data.maxYear <- aggregateGrid(redim(data), aggr.y = list(FUN = "max",na.rm = TRUE))

  data.maxrv <- climatology(data, clim.fun = list(FUN = "mean", na.rm = T))

  auxData <- data.maxYear$Data
  auxData[which(is.infinite(auxData))] <- NA

  if (any(!is.na(auxData))){
      auxGEV <- fgev(auxData)
      if ((auxGEV$estimate[3] - auxGEV$std.err[3] < 0) & (0  < auxGEV$estimate[3] + auxGEV$std.err[3])){
        auxGEV <- fgev(auxData, shape = 0)
        auxRV <- qgev(1-1/nyears, loc = auxGEV$estimate[1], scale = auxGEV$estimate[2], shape = 0)
      }else{
        auxRV <- qgev(1-1/nyears, loc = auxGEV$estimate[1], scale = auxGEV$estimate[2], shape = auxGEV$estimate[3])
      }
      data.maxrv <- as.numeric(auxRV)
      names(data.maxrv) <- paste("RV",nyears,"_max", sep = "")
  }
  return(data.maxrv)
  }
```



## Wallis and Futuna


```{r}
i=1

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))


```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
station.obs.cl1 <- setTimeResolution(station.obs.cl1, time_resolution = "DD")
station.trmm.cl1 <- setTimeResolution(station.trmm.cl1, time_resolution = "DD")

station.obs.cl1 <- setGridDates.asPOSIXlt(station.obs.cl1, tz = "UTC")
station.trmm.cl1 <- setGridDates.asPOSIXlt(station.trmm.cl1, tz = "UTC")

cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm",cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st1.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
station.obs.cl2 <- setTimeResolution(station.obs.cl2, time_resolution = "DD")
station.trmm.cl2 <- setTimeResolution(station.trmm.cl2, time_resolution = "DD")

station.obs.cl2 <- setGridDates.asPOSIXlt(station.obs.cl2, tz = "UTC")
station.trmm.cl2 <- setGridDates.asPOSIXlt(station.trmm.cl2, tz = "UTC")

cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT2","EQM-WT2","GPQM-WT2","GPQM2-WT2")
scores <- sort(scores, decreasing = T)
scores


```
```{r}
scores.st1.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
station.obs.cl3 <- setTimeResolution(station.obs.cl3, time_resolution = "DD")
station.trmm.cl3 <- setTimeResolution(station.trmm.cl3, time_resolution = "DD")

station.obs.cl3 <- setGridDates.asPOSIXlt(station.obs.cl3, tz = "UTC")
station.trmm.cl3 <- setGridDates.asPOSIXlt(station.trmm.cl3, tz = "UTC")

cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
station.obs.cl4 <- setTimeResolution(station.obs.cl4, time_resolution = "DD")
station.trmm.cl4 <- setTimeResolution(station.trmm.cl4, time_resolution = "DD")

station.obs.cl4 <- setGridDates.asPOSIXlt(station.obs.cl4, tz = "UTC")
station.trmm.cl4 <- setGridDates.asPOSIXlt(station.trmm.cl4, tz = "UTC")


cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
station.obs.cl5 <- setTimeResolution(station.obs.cl5, time_resolution = "DD")
station.trmm.cl5 <- setTimeResolution(station.trmm.cl5, time_resolution = "DD")

station.obs.cl5 <- setGridDates.asPOSIXlt(station.obs.cl5, tz = "UTC")
station.trmm.cl5 <- setGridDates.asPOSIXlt(station.trmm.cl5, tz = "UTC")

cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt5 <- scores
```




### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```
```{r}
station.obs <- setGridDates.asPOSIXlt(station.obs, tz = "UTC")
station.trmm <- setGridDates.asPOSIXlt(station.trmm, tz = "UTC")
```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = 'loo')

cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")
cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")

cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st1.wt1[1]),names(scores.st1.wt2[1]),names(scores.st1.wt3[1]),names(scores.st1.wt4[1]),names(scores.st1.wt5[1]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.pqm <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T ) 

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.pqm$Dates$start <- as.POSIXct(cal.station.cl1.pqm$Dates$start,tz = "GMT")
cal.station.cl1.pqm$Dates$end <- as.POSIXct(cal.station.cl1.pqm$Dates$end,tz = "GMT")

cal.station.cl2.pqm <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.pqm$Dates$start <- as.POSIXct(cal.station.cl2.pqm$Dates$start,tz = "GMT")
cal.station.cl2.pqm$Dates$end <- as.POSIXct(cal.station.cl2.pqm$Dates$end,tz = "GMT")

cal.station.cl3.pqm <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.pqm$Dates$start <- as.POSIXct(cal.station.cl3.pqm$Dates$start,tz = "GMT")
cal.station.cl3.pqm$Dates$end <- as.POSIXct(cal.station.cl3.pqm$Dates$end,tz = "GMT")

cal.station.cl4.gpqm2 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = 'loo', wt = T) 

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.gpqm2$Dates$start <- as.POSIXct(cal.station.cl4.gpqm2$Dates$start,tz = "GMT")
cal.station.cl4.gpqm2$Dates$end <- as.POSIXct(cal.station.cl4.gpqm2$Dates$end,tz = "GMT")

cal.station.cl5.pqm <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T) 

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.pqm$Dates$start <- as.POSIXct(cal.station.cl5.pqm$Dates$start,tz = "GMT")
cal.station.cl5.pqm$Dates$end <- as.POSIXct(cal.station.cl5.pqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.pqm$Data))
cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.pqm$Data))
cal.station.cl2.pqm <- subsetDimension(cal.station.cl2.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.pqm$Data))
cal.station.cl3.pqm <- subsetDimension(cal.station.cl3.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.gpqm2$Data))
cal.station.cl4.gpqm2 <- subsetDimension(cal.station.cl4.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.pqm$Data))
cal.station.cl5.pqm <- subsetDimension(cal.station.cl5.pqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.pqm, cal.station.cl2.pqm, cal.station.cl3.pqm,
                           cal.station.cl4.gpqm2, cal.station.cl5.pqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
#cambiar de tipo de biasCorrection y fillGridDates
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')
```


```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.eqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.eqm <- c(index.eqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.eqm.rv20max <- MaxReturnValue(cal.station.complete)

index.eqm<- c(index.eqm ,index.eqm.rv20max)

index.eqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.eqm <- abs(index.obs-index.eqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][5]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("PQM-C","EQM-C","GPQM-C","GPQM2-C","Combined")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.eqm)

colnames(df) <- c("Observation","Conditioned", "EQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.eqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias EQM")

format(bias.df, digits = 3, scientific = 5)
```

```{r}
df.st1 <- df
bias.df.st1 <- bias.df
```

```{r}
bias.rel.cond <- (abs(df[,2]-df[,1])/df[,1])*100

names(bias.rel.cond) <- names(diff.conditioned)

bias.rel.no.cond <- (abs(df[,3]-df[,1])/df[,1])*100

names(bias.rel.no.cond) <- names(diff.conditioned)
```

```{r}
bias.rel.df <- data.frame(bias.rel.cond, bias.rel.no.cond)

colnames(bias.rel.df) <- c("Relative Bias Conditioned", "Relative Bias EQM")

format(bias.rel.df, digits = 3, scientific = 5)
```


```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,500))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```

## Alofi, Niue
```{r}
i=2

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))


```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
station.obs.cl1 <- setTimeResolution(station.obs.cl1, time_resolution = "DD")
station.trmm.cl1 <- setTimeResolution(station.trmm.cl1, time_resolution = "DD")

station.obs.cl1 <- setGridDates.asPOSIXlt(station.obs.cl1, tz = "UTC")
station.trmm.cl1 <- setGridDates.asPOSIXlt(station.trmm.cl1, tz = "UTC")

cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm",cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st2.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
station.obs.cl2 <- setTimeResolution(station.obs.cl2, time_resolution = "DD")
station.trmm.cl2 <- setTimeResolution(station.trmm.cl2, time_resolution = "DD")

station.obs.cl2 <- setGridDates.asPOSIXlt(station.obs.cl2, tz = "UTC")
station.trmm.cl2 <- setGridDates.asPOSIXlt(station.trmm.cl2, tz = "UTC")

cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT2","EQM-WT2","GPQM-WT2","GPQM2-WT2")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st2.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
station.obs.cl3 <- setTimeResolution(station.obs.cl3, time_resolution = "DD")
station.trmm.cl3 <- setTimeResolution(station.trmm.cl3, time_resolution = "DD")

station.obs.cl3 <- setGridDates.asPOSIXlt(station.obs.cl3, tz = "UTC")
station.trmm.cl3 <- setGridDates.asPOSIXlt(station.trmm.cl3, tz = "UTC")

cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st2.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
station.obs.cl4 <- setTimeResolution(station.obs.cl4, time_resolution = "DD")
station.trmm.cl4 <- setTimeResolution(station.trmm.cl4, time_resolution = "DD")

station.obs.cl4 <- setGridDates.asPOSIXlt(station.obs.cl4, tz = "UTC")
station.trmm.cl4 <- setGridDates.asPOSIXlt(station.trmm.cl4, tz = "UTC")


cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st2.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
station.obs.cl5 <- setTimeResolution(station.obs.cl5, time_resolution = "DD")
station.trmm.cl5 <- setTimeResolution(station.trmm.cl5, time_resolution = "DD")

station.obs.cl5 <- setGridDates.asPOSIXlt(station.obs.cl5, tz = "UTC")
station.trmm.cl5 <- setGridDates.asPOSIXlt(station.trmm.cl5, tz = "UTC")

cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st2.wt5 <- scores
```




### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```
```{r}
station.obs <- setGridDates.asPOSIXlt(station.obs, tz = "UTC")
station.trmm <- setGridDates.asPOSIXlt(station.trmm, tz = "UTC")
```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = 'loo')

cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")
cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")

cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7)


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st2.wt1[1]),names(scores.st2.wt2[1]),names(scores.st2.wt3[1]),names(scores.st2.wt4[1]),names(scores.st2.wt5[1]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}

cal.station.cl1.pqm <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm", cross.val = "loo", wt = T)

cal.station.cl1.pqm$Dates$start <- as.POSIXct(cal.station.cl1.pqm$Dates$start,tz = "GMT")
cal.station.cl1.pqm$Dates$end <- as.POSIXct(cal.station.cl1.pqm$Dates$end,tz = "GMT")

cal.station.cl2.eqm <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)
cal.station.cl2.eqm$Dates$start <- as.POSIXct(cal.station.cl2.eqm$Dates$start,tz = "GMT")
cal.station.cl2.eqm$Dates$end <- as.POSIXct(cal.station.cl2.eqm$Dates$end,tz = "GMT")

cal.station.cl3.gpqm <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", cross.val = "loo", wt = T)

cal.station.cl3.gpqm$Dates$start <- as.POSIXct(cal.station.cl3.gpqm$Dates$start,tz = "GMT")
cal.station.cl3.gpqm$Dates$end <- as.POSIXct(cal.station.cl3.gpqm$Dates$end,tz = "GMT")

cal.station.cl4.pqm <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm", cross.val = "loo", wt = T)
cal.station.cl4.pqm$Dates$start <- as.POSIXct(cal.station.cl4.pqm$Dates$start,tz = "GMT")
cal.station.cl4.pqm$Dates$end <- as.POSIXct(cal.station.cl4.pqm$Dates$end,tz = "GMT")

cal.station.cl5.eqm <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)

cal.station.cl5.eqm$Dates$start <- as.POSIXct(cal.station.cl5.eqm$Dates$start,tz = "GMT")
cal.station.cl5.eqm$Dates$end <- as.POSIXct(cal.station.cl5.eqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.pqm$Data))
cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.eqm$Data))
cal.station.cl2.eqm <- subsetDimension(cal.station.cl2.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.gpqm$Data))
cal.station.cl3.gpqm <- subsetDimension(cal.station.cl3.gpqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.pqm$Data))
cal.station.cl4.pqm <- subsetDimension(cal.station.cl4.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.eqm$Data))
cal.station.cl5.eqm <- subsetDimension(cal.station.cl5.eqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.pqm, cal.station.cl2.eqm, cal.station.cl3.gpqm,
                           cal.station.cl4.pqm, cal.station.cl5.eqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
#cambiar de tipo de biasCorrection y fillGridDates
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = 'loo')
```


```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.pqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.pqm <- c(index.pqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.pqm.rv20max <- MaxReturnValue(cal.station.complete)

index.pqm<- c(index.pqm ,index.pqm.rv20max)

index.pqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.pqm <- abs(index.obs-index.pqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][5]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("PQM-C","EQM-C","GPQM-C","GPQM2-C","Combined")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.eqm)

colnames(df) <- c("Observation","Conditioned", "PQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.eqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias PQM")

format(bias.df, digits = 3, scientific = 5)
```

```{r}
df.st1 <- df
bias.df.st1 <- bias.df
```

```{r}
bias.rel.cond <- (abs(df[,2]-df[,1])/df[,1])*100

names(bias.rel.cond) <- names(diff.conditioned)

bias.rel.no.cond <- (abs(df[,3]-df[,1])/df[,1])*100

names(bias.rel.no.cond) <- names(diff.conditioned)
```

```{r}
bias.rel.df <- data.frame(bias.rel.cond, bias.rel.no.cond)

colnames(bias.rel.df) <- c("Relative Bias Conditioned", "Relative Bias PQM")

format(bias.rel.df, digits = 3, scientific = 5)
```


```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,500))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```

## Rarotonga, Cook Islands

```{r}
i=3

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))


```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
station.obs.cl1 <- setTimeResolution(station.obs.cl1, time_resolution = "DD")
station.trmm.cl1 <- setTimeResolution(station.trmm.cl1, time_resolution = "DD")

station.obs.cl1 <- setGridDates.asPOSIXlt(station.obs.cl1, tz = "UTC")
station.trmm.cl1 <- setGridDates.asPOSIXlt(station.trmm.cl1, tz = "UTC")

cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm",cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st3.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
station.obs.cl2 <- setTimeResolution(station.obs.cl2, time_resolution = "DD")
station.trmm.cl2 <- setTimeResolution(station.trmm.cl2, time_resolution = "DD")

station.obs.cl2 <- setGridDates.asPOSIXlt(station.obs.cl2, tz = "UTC")
station.trmm.cl2 <- setGridDates.asPOSIXlt(station.trmm.cl2, tz = "UTC")

cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT2","EQM-WT2","GPQM-WT2","GPQM2-WT2")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st3.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
station.obs.cl3 <- setTimeResolution(station.obs.cl3, time_resolution = "DD")
station.trmm.cl3 <- setTimeResolution(station.trmm.cl3, time_resolution = "DD")

station.obs.cl3 <- setGridDates.asPOSIXlt(station.obs.cl3, tz = "UTC")
station.trmm.cl3 <- setGridDates.asPOSIXlt(station.trmm.cl3, tz = "UTC")

cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st3.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
station.obs.cl4 <- setTimeResolution(station.obs.cl4, time_resolution = "DD")
station.trmm.cl4 <- setTimeResolution(station.trmm.cl4, time_resolution = "DD")

station.obs.cl4 <- setGridDates.asPOSIXlt(station.obs.cl4, tz = "UTC")
station.trmm.cl4 <- setGridDates.asPOSIXlt(station.trmm.cl4, tz = "UTC")


cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T) 


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)

scores
```
```{r}
scores.st3.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
station.obs.cl5 <- setTimeResolution(station.obs.cl5, time_resolution = "DD")
station.trmm.cl5 <- setTimeResolution(station.trmm.cl5, time_resolution = "DD")

station.obs.cl5 <- setGridDates.asPOSIXlt(station.obs.cl5, tz = "UTC")
station.trmm.cl5 <- setGridDates.asPOSIXlt(station.trmm.cl5, tz = "UTC")

cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st3.wt5 <- scores
```




### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```
```{r}
station.obs <- setGridDates.asPOSIXlt(station.obs, tz = "UTC")
station.trmm <- setGridDates.asPOSIXlt(station.trmm, tz = "UTC")
```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = 'loo')

cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")
cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")

cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st3.wt1[1]),names(scores.st3.wt2[1]),names(scores.st3.wt3[1]),names(scores.st3.wt4[1]),names(scores.st3.wt5[2]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.pqm <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.pqm$Dates$start <- as.POSIXct(cal.station.cl1.pqm$Dates$start,tz = "GMT")
cal.station.cl1.pqm$Dates$end <- as.POSIXct(cal.station.cl1.pqm$Dates$end,tz = "GMT")

cal.station.cl2.gpqm2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.gpqm2$Dates$start <- as.POSIXct(cal.station.cl2.gpqm2$Dates$start,tz = "GMT")
cal.station.cl2.gpqm2$Dates$end <- as.POSIXct(cal.station.cl2.gpqm2$Dates$end,tz = "GMT")

cal.station.cl3.gpqm2 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.gpqm2$Dates$start <- as.POSIXct(cal.station.cl3.gpqm2$Dates$start,tz = "GMT")
cal.station.cl3.gpqm2$Dates$end <- as.POSIXct(cal.station.cl3.gpqm2$Dates$end,tz = "GMT")

cal.station.cl4.gpqm <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", wt = T)


#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.gpqm$Dates$start <- as.POSIXct(cal.station.cl4.gpqm$Dates$start,tz = "GMT")
cal.station.cl4.gpqm$Dates$end <- as.POSIXct(cal.station.cl4.gpqm$Dates$end,tz = "GMT")

cal.station.cl5.gpqm2 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = 'loo', wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.gpqm2$Dates$start <- as.POSIXct(cal.station.cl5.gpqm2$Dates$start,tz = "GMT")
cal.station.cl5.gpqm2$Dates$end <- as.POSIXct(cal.station.cl5.gpqm2$Dates$end,tz = "GMT")



idx <- which(!is.na(cal.station.cl1.pqm$Data))
cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.gpqm2$Data))
cal.station.cl2.gpqm2 <- subsetDimension(cal.station.cl2.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.gpqm2$Data))
cal.station.cl3.gpqm2 <- subsetDimension(cal.station.cl3.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.gpqm$Data))
cal.station.cl4.gpqm <- subsetDimension(cal.station.cl4.gpqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.gpqm2$Data))
cal.station.cl5.gpqm2 <- subsetDimension(cal.station.cl5.gpqm2, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.pqm, cal.station.cl2.gpqm2, cal.station.cl3.gpqm2,
                           cal.station.cl4.gpqm, cal.station.cl5.gpqm2, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
#cambiar de tipo de biasCorrection y fillGridDates
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = "loo")

```


```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.pqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.pqm <- c(index.pqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.pqm.rv20max <- MaxReturnValue(cal.station.complete)

index.pqm<- c(index.pqm ,index.pqm.rv20max)

index.pqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.pqm <- abs(index.obs-index.pqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][5]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("PQM-C","EQM-C","GPQM-C","GPQM2-C","Combined")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.pqm)

colnames(df) <- c("Observation","Conditioned", "GPQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.pqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias PQM")

format(bias.df, digits = 3, scientific = 5)
```

```{r}
df.st1 <- df
bias.df.st1 <- bias.df
```

```{r}
bias.rel.cond <- (abs(df[,2]-df[,1])/df[,1])*100

names(bias.rel.cond) <- names(diff.conditioned)

bias.rel.no.cond <- (abs(df[,3]-df[,1])/df[,1])*100

names(bias.rel.no.cond) <- names(diff.conditioned)
```

```{r}
bias.rel.df <- data.frame(bias.rel.cond, bias.rel.no.cond)

colnames(bias.rel.df) <- c("Relative Bias Conditioned", "Relative Bias GPQM")

format(bias.rel.df, digits = 3, scientific = 5)
```


```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,500))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```
## Raoul Island, New Zealand
```{r}
i=4

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))


```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
station.obs.cl1 <- setTimeResolution(station.obs.cl1, time_resolution = "DD")
station.trmm.cl1 <- setTimeResolution(station.trmm.cl1, time_resolution = "DD")

station.obs.cl1 <- setGridDates.asPOSIXlt(station.obs.cl1, tz = "UTC")
station.trmm.cl1 <- setGridDates.asPOSIXlt(station.trmm.cl1, tz = "UTC")

cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm",cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo' , wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st4.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
station.obs.cl2 <- setTimeResolution(station.obs.cl2, time_resolution = "DD")
station.trmm.cl2 <- setTimeResolution(station.trmm.cl2, time_resolution = "DD")

station.obs.cl2 <- setGridDates.asPOSIXlt(station.obs.cl2, tz = "UTC")
station.trmm.cl2 <- setGridDates.asPOSIXlt(station.trmm.cl2, tz = "UTC")

cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT2","EQM-WT2","GPQM-WT2","GPQM2-WT2")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st4.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
station.obs.cl3 <- setTimeResolution(station.obs.cl3, time_resolution = "DD")
station.trmm.cl3 <- setTimeResolution(station.trmm.cl3, time_resolution = "DD")

station.obs.cl3 <- setGridDates.asPOSIXlt(station.obs.cl3, tz = "UTC")
station.trmm.cl3 <- setGridDates.asPOSIXlt(station.trmm.cl3, tz = "UTC")

cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st4.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
station.obs.cl4 <- setTimeResolution(station.obs.cl4, time_resolution = "DD")
station.trmm.cl4 <- setTimeResolution(station.trmm.cl4, time_resolution = "DD")

station.obs.cl4 <- setGridDates.asPOSIXlt(station.obs.cl4, tz = "UTC")
station.trmm.cl4 <- setGridDates.asPOSIXlt(station.trmm.cl4, tz = "UTC")


cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st4.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
station.obs.cl5 <- setTimeResolution(station.obs.cl5, time_resolution = "DD")
station.trmm.cl5 <- setTimeResolution(station.trmm.cl5, time_resolution = "DD")

station.obs.cl5 <- setGridDates.asPOSIXlt(station.obs.cl5, tz = "UTC")
station.trmm.cl5 <- setGridDates.asPOSIXlt(station.trmm.cl5, tz = "UTC")

cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st4.wt5 <- scores
```




### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```
```{r}
station.obs <- setGridDates.asPOSIXlt(station.obs, tz = "UTC")
station.trmm <- setGridDates.asPOSIXlt(station.trmm, tz = "UTC")
```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = 'loo')

cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")
cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")

cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st4.wt1[1]),names(scores.st4.wt2[1]),names(scores.st4.wt3[1]),names(scores.st4.wt4[1]),names(scores.st4.wt5[1]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.eqm <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)


#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.eqm$Dates$start <- as.POSIXct(cal.station.cl1.eqm$Dates$start,tz = "GMT")
cal.station.cl1.eqm$Dates$end <- as.POSIXct(cal.station.cl1.eqm$Dates$end,tz = "GMT")

cal.station.cl2.eqm <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))


cal.station.cl2.eqm$Dates$start <- as.POSIXct(cal.station.cl2.eqm$Dates$start,tz = "GMT")
cal.station.cl2.eqm$Dates$end <- as.POSIXct(cal.station.cl2.eqm$Dates$end,tz = "GMT")

cal.station.cl3.pqm <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm", cross.val = "loo", wt = T) 

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.pqm$Dates$start <- as.POSIXct(cal.station.cl3.pqm$Dates$start,tz = "GMT")
cal.station.cl3.pqm$Dates$end <- as.POSIXct(cal.station.cl3.pqm$Dates$end,tz = "GMT")

cal.station.cl4.eqm <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.eqm$Dates$start <- as.POSIXct(cal.station.cl4.eqm$Dates$start,tz = "GMT")
cal.station.cl4.eqm$Dates$end <- as.POSIXct(cal.station.cl4.eqm$Dates$end,tz = "GMT")

cal.station.cl5.eqm <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.eqm$Dates$start <- as.POSIXct(cal.station.cl5.eqm$Dates$start,tz = "GMT")
cal.station.cl5.eqm$Dates$end <- as.POSIXct(cal.station.cl5.eqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.eqm$Data))
cal.station.cl1.eqm <- subsetDimension(cal.station.cl1.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.eqm$Data))
cal.station.cl2.eqm <- subsetDimension(cal.station.cl2.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.pqm$Data))
cal.station.cl3.pqm <- subsetDimension(cal.station.cl3.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.eqm$Data))
cal.station.cl4.eqm <- subsetDimension(cal.station.cl4.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.eqm$Data))
cal.station.cl5.eqm <- subsetDimension(cal.station.cl5.eqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.eqm, cal.station.cl2.eqm, cal.station.cl3.pqm,
                           cal.station.cl4.eqm, cal.station.cl5.eqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
#cambiar de tipo de biasCorrection y fillGridDates
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')
```


```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.eqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.eqm <- c(index.eqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.eqm.rv20max <- MaxReturnValue(cal.station.complete)

index.eqm<- c(index.eqm ,index.eqm.rv20max)

index.eqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.eqm <- abs(index.obs-index.eqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][5]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("PQM-C","EQM-C","GPQM-C","GPQM2-C","Combined")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.eqm)

colnames(df) <- c("Observation","Conditioned", "EQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.eqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias EQM")

format(bias.df, digits = 3, scientific = 5)
```

```{r}
df.st1 <- df
bias.df.st1 <- bias.df
```

```{r}
bias.rel.cond <- (abs(df[,2]-df[,1])/df[,1])*100

names(bias.rel.cond) <- names(diff.conditioned)

bias.rel.no.cond <- (abs(df[,3]-df[,1])/df[,1])*100

names(bias.rel.no.cond) <- names(diff.conditioned)
```

```{r}
bias.rel.df <- data.frame(bias.rel.cond, bias.rel.no.cond)

colnames(bias.rel.df) <- c("Relative Bias Conditioned", "Relative Bias EQM")

format(bias.rel.df, digits = 3, scientific = 5)
```


```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,500))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```
## ocean buoy?
```{r}
i=5

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))


```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
station.obs.cl1 <- setTimeResolution(station.obs.cl1, time_resolution = "DD")
station.trmm.cl1 <- setTimeResolution(station.trmm.cl1, time_resolution = "DD")

station.obs.cl1 <- setGridDates.asPOSIXlt(station.obs.cl1, tz = "UTC")
station.trmm.cl1 <- setGridDates.asPOSIXlt(station.trmm.cl1, tz = "UTC")

cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm",cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st5.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
station.obs.cl2 <- setTimeResolution(station.obs.cl2, time_resolution = "DD")
station.trmm.cl2 <- setTimeResolution(station.trmm.cl2, time_resolution = "DD")

station.obs.cl2 <- setGridDates.asPOSIXlt(station.obs.cl2, tz = "UTC")
station.trmm.cl2 <- setGridDates.asPOSIXlt(station.trmm.cl2, tz = "UTC")

cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm", cross.val = 'loo')


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T) 


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT2","EQM-WT2","GPQM-WT2","GPQM2-WT2")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st5.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
station.obs.cl3 <- setTimeResolution(station.obs.cl3, time_resolution = "DD")
station.trmm.cl3 <- setTimeResolution(station.trmm.cl3, time_resolution = "DD")

station.obs.cl3 <- setGridDates.asPOSIXlt(station.obs.cl3, tz = "UTC")
station.trmm.cl3 <- setGridDates.asPOSIXlt(station.trmm.cl3, tz = "UTC")

cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st5.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
station.obs.cl4 <- setTimeResolution(station.obs.cl4, time_resolution = "DD")
station.trmm.cl4 <- setTimeResolution(station.trmm.cl4, time_resolution = "DD")

station.obs.cl4 <- setGridDates.asPOSIXlt(station.obs.cl4, tz = "UTC")
station.trmm.cl4 <- setGridDates.asPOSIXlt(station.trmm.cl4, tz = "UTC")


cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st5.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
station.obs.cl5 <- setTimeResolution(station.obs.cl5, time_resolution = "DD")
station.trmm.cl5 <- setTimeResolution(station.trmm.cl5, time_resolution = "DD")

station.obs.cl5 <- setGridDates.asPOSIXlt(station.obs.cl5, tz = "UTC")
station.trmm.cl5 <- setGridDates.asPOSIXlt(station.trmm.cl5, tz = "UTC")

cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st5.wt5 <- scores
```




### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```
```{r}
station.obs <- setGridDates.asPOSIXlt(station.obs, tz = "UTC")
station.trmm <- setGridDates.asPOSIXlt(station.trmm, tz = "UTC")
```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = 'loo')

cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")
cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")

cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st5.wt1[1]),names(scores.st5.wt2[1]),names(scores.st5.wt3[1]),names(scores.st5.wt4[1]),names(scores.st5.wt5[1]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.eqm <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)


#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.eqm$Dates$start <- as.POSIXct(cal.station.cl1.eqm$Dates$start,tz = "GMT")
cal.station.cl1.eqm$Dates$end <- as.POSIXct(cal.station.cl1.eqm$Dates$end,tz = "GMT")

cal.station.cl2.eqm <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)


#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.eqm$Dates$start <- as.POSIXct(cal.station.cl2.eqm$Dates$start,tz = "GMT")
cal.station.cl2.eqm$Dates$end <- as.POSIXct(cal.station.cl2.eqm$Dates$end,tz = "GMT")

cal.station.cl3.gpqm2 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = 'loo', wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.gpqm2$Dates$start <- as.POSIXct(cal.station.cl3.gpqm2$Dates$start,tz = "GMT")
cal.station.cl3.gpqm2$Dates$end <- as.POSIXct(cal.station.cl3.gpqm2$Dates$end,tz = "GMT")

cal.station.cl4.pqm <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm", cross.val = "loo", wt = T)


#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.pqm$Dates$start <- as.POSIXct(cal.station.cl4.pqm$Dates$start,tz = "GMT")
cal.station.cl4.pqm$Dates$end <- as.POSIXct(cal.station.cl4.pqm$Dates$end,tz = "GMT")

cal.station.cl5.gpqm2 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm",theta = .7, cross.val = 'loo', wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.gpqm2$Dates$start <- as.POSIXct(cal.station.cl5.gpqm2$Dates$start,tz = "GMT")
cal.station.cl5.gpqm2$Dates$end <- as.POSIXct(cal.station.cl5.gpqm2$Dates$end,tz = "GMT")

idx <- which(!is.na(cal.station.cl1.eqm$Data))
cal.station.cl1.eqm <- subsetDimension(cal.station.cl1.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.eqm$Data))
cal.station.cl2.eqm <- subsetDimension(cal.station.cl2.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.gpqm2$Data))
cal.station.cl3.gpqm2 <- subsetDimension(cal.station.cl3.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.pqm$Data))
cal.station.cl4.pqm <- subsetDimension(cal.station.cl4.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.gpqm2$Data))
cal.station.cl5.gpqm2 <- subsetDimension(cal.station.cl5.gpqm2, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.eqm, cal.station.cl2.eqm, cal.station.cl3.gpqm2,
                           cal.station.cl4.pqm, cal.station.cl5.gpqm2, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
#cambiar de tipo de biasCorrection y fillGridDates
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')
```


```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.eqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.eqm <- c(index.eqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.eqm.rv20max <- MaxReturnValue(cal.station.complete)

index.eqm<- c(index.eqm ,index.eqm.rv20max)

index.eqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.eqm <- abs(index.obs-index.eqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][5]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("PQM-C","EQM-C","GPQM-C","GPQM2-C","Combined")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.eqm)

colnames(df) <- c("Observation","Conditioned", "EQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.eqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias EQM")

format(bias.df, digits = 3, scientific = 5)
```

```{r}
df.st1 <- df
bias.df.st1 <- bias.df
```

```{r}
bias.rel.cond <- (abs(df[,2]-df[,1])/df[,1])*100

names(bias.rel.cond) <- names(diff.conditioned)

bias.rel.no.cond <- (abs(df[,3]-df[,1])/df[,1])*100

names(bias.rel.no.cond) <- names(diff.conditioned)
```

```{r}
bias.rel.df <- data.frame(bias.rel.cond, bias.rel.no.cond)

colnames(bias.rel.df) <- c("Relative Bias Conditioned", "Relative Bias EQM")

format(bias.rel.df, digits = 3, scientific = 5)
```


```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,500))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```
## Aoloau, American  Samoa
```{r}
i=6

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))


```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
station.obs.cl1 <- setTimeResolution(station.obs.cl1, time_resolution = "DD")
station.trmm.cl1 <- setTimeResolution(station.trmm.cl1, time_resolution = "DD")

station.obs.cl1 <- setGridDates.asPOSIXlt(station.obs.cl1, tz = "UTC")
station.trmm.cl1 <- setGridDates.asPOSIXlt(station.trmm.cl1, tz = "UTC")

cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm",cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st6.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
station.obs.cl2 <- setTimeResolution(station.obs.cl2, time_resolution = "DD")
station.trmm.cl2 <- setTimeResolution(station.trmm.cl2, time_resolution = "DD")

station.obs.cl2 <- setGridDates.asPOSIXlt(station.obs.cl2, tz = "UTC")
station.trmm.cl2 <- setGridDates.asPOSIXlt(station.trmm.cl2, tz = "UTC")

cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT2","EQM-WT2","GPQM-WT2","GPQM2-WT2")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st6.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
station.obs.cl3 <- setTimeResolution(station.obs.cl3, time_resolution = "DD")
station.trmm.cl3 <- setTimeResolution(station.trmm.cl3, time_resolution = "DD")

station.obs.cl3 <- setGridDates.asPOSIXlt(station.obs.cl3, tz = "UTC")
station.trmm.cl3 <- setGridDates.asPOSIXlt(station.trmm.cl3, tz = "UTC")

cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st6.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
station.obs.cl4 <- setTimeResolution(station.obs.cl4, time_resolution = "DD")
station.trmm.cl4 <- setTimeResolution(station.trmm.cl4, time_resolution = "DD")

station.obs.cl4 <- setGridDates.asPOSIXlt(station.obs.cl4, tz = "UTC")
station.trmm.cl4 <- setGridDates.asPOSIXlt(station.trmm.cl4, tz = "UTC")


cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st6.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
station.obs.cl5 <- setTimeResolution(station.obs.cl5, time_resolution = "DD")
station.trmm.cl5 <- setTimeResolution(station.trmm.cl5, time_resolution = "DD")

station.obs.cl5 <- setGridDates.asPOSIXlt(station.obs.cl5, tz = "UTC")
station.trmm.cl5 <- setGridDates.asPOSIXlt(station.trmm.cl5, tz = "UTC")

cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st6.wt5 <- scores
```




### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```
```{r}
station.obs <- setGridDates.asPOSIXlt(station.obs, tz = "UTC")
station.trmm <- setGridDates.asPOSIXlt(station.trmm, tz = "UTC")
```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = 'loo')

cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")
cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")

cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = "loo")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st6.wt1[1]),names(scores.st6.wt2[1]),names(scores.st6.wt3[1]),names(scores.st6.wt4[1]),names(scores.st6.wt5[1]), names(scores.complete[1]))

```

### Combination of techniques by WT

```{r}
cal.station.cl1.eqm <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm",cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))
cal.station.cl1.eqm$Dates$start <- as.POSIXct(cal.station.cl1.eqm$Dates$start,tz = "GMT")
cal.station.cl1.eqm$Dates$end <- as.POSIXct(cal.station.cl1.eqm$Dates$end,tz = "GMT")

cal.station.cl2.pqm <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm", cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.pqm$Dates$start <- as.POSIXct(cal.station.cl2.pqm$Dates$start,tz = "GMT")
cal.station.cl2.pqm$Dates$end <- as.POSIXct(cal.station.cl2.pqm$Dates$end,tz = "GMT")

cal.station.cl3.pqm <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm", cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.pqm$Dates$start <- as.POSIXct(cal.station.cl3.pqm$Dates$start,tz = "GMT")
cal.station.cl3.pqm$Dates$end <- as.POSIXct(cal.station.cl3.pqm$Dates$end,tz = "GMT")

cal.station.cl4.eqm <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)


#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.eqm$Dates$start <- as.POSIXct(cal.station.cl4.eqm$Dates$start,tz = "GMT")
cal.station.cl4.eqm$Dates$end <- as.POSIXct(cal.station.cl4.eqm$Dates$end,tz = "GMT")

cal.station.cl5.eqm <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.eqm$Dates$start <- as.POSIXct(cal.station.cl5.eqm$Dates$start,tz = "GMT")
cal.station.cl5.eqm$Dates$end <- as.POSIXct(cal.station.cl5.eqm$Dates$end,tz = "GMT")



idx <- which(!is.na(cal.station.cl1.eqm$Data))
cal.station.cl1.eqm <- subsetDimension(cal.station.cl1.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.pqm$Data))
cal.station.cl2.pqm <- subsetDimension(cal.station.cl2.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.pqm$Data))
cal.station.cl3.pqm <- subsetDimension(cal.station.cl3.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.eqm$Data))
cal.station.cl4.eqm <- subsetDimension(cal.station.cl4.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.eqm$Data))
cal.station.cl5.eqm <- subsetDimension(cal.station.cl5.eqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.eqm, cal.station.cl2.pqm, cal.station.cl3.pqm,
                           cal.station.cl4.eqm, cal.station.cl5.eqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
#cambiar de tipo de biasCorrection y fillGridDates
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = 'loo')
```


```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.pqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.pqm <- c(index.pqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.pqm.rv20max <- MaxReturnValue(cal.station.complete)

index.pqm<- c(index.pqm ,index.pqm.rv20max)

index.pqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.pqm <- abs(index.obs-index.pqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][5]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("PQM-C","EQM-C","GPQM-C","GPQM2-C","Combined")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.cal.station.pqm.complete)

colnames(df) <- c("Observation","Conditioned", "PQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.pqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias PQM")

format(bias.df, digits = 3, scientific = 5)
```

```{r}
df.st1 <- df
bias.df.st1 <- bias.df
```

```{r}
bias.rel.cond <- (abs(df[,2]-df[,1])/df[,1])*100

names(bias.rel.cond) <- names(diff.conditioned)

bias.rel.no.cond <- (abs(df[,3]-df[,1])/df[,1])*100

names(bias.rel.no.cond) <- names(diff.conditioned)
```

```{r}
bias.rel.df <- data.frame(bias.rel.cond, bias.rel.no.cond)

colnames(bias.rel.df) <- c("Relative Bias Conditioned", "Relative Bias PQM")

format(bias.rel.df, digits = 3, scientific = 5)
```


```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,500))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```
## Nu'uuli, American Samoa
```{r}
i=7

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))


```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
station.obs.cl1 <- setTimeResolution(station.obs.cl1, time_resolution = "DD")
station.trmm.cl1 <- setTimeResolution(station.trmm.cl1, time_resolution = "DD")

station.obs.cl1 <- setGridDates.asPOSIXlt(station.obs.cl1, tz = "UTC")
station.trmm.cl1 <- setGridDates.asPOSIXlt(station.trmm.cl1, tz = "UTC")

cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm",cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st7.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
station.obs.cl2 <- setTimeResolution(station.obs.cl2, time_resolution = "DD")
station.trmm.cl2 <- setTimeResolution(station.trmm.cl2, time_resolution = "DD")

station.obs.cl2 <- setGridDates.asPOSIXlt(station.obs.cl2, tz = "UTC")
station.trmm.cl2 <- setGridDates.asPOSIXlt(station.trmm.cl2, tz = "UTC")

cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT2","EQM-WT2","GPQM-WT2","GPQM2-WT2")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st7.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
station.obs.cl3 <- setTimeResolution(station.obs.cl3, time_resolution = "DD")
station.trmm.cl3 <- setTimeResolution(station.trmm.cl3, time_resolution = "DD")

station.obs.cl3 <- setGridDates.asPOSIXlt(station.obs.cl3, tz = "UTC")
station.trmm.cl3 <- setGridDates.asPOSIXlt(station.trmm.cl3, tz = "UTC")

cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st7.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
station.obs.cl4 <- setTimeResolution(station.obs.cl4, time_resolution = "DD")
station.trmm.cl4 <- setTimeResolution(station.trmm.cl4, time_resolution = "DD")

station.obs.cl4 <- setGridDates.asPOSIXlt(station.obs.cl4, tz = "UTC")
station.trmm.cl4 <- setGridDates.asPOSIXlt(station.trmm.cl4, tz = "UTC")


cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st7.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
station.obs.cl5 <- setTimeResolution(station.obs.cl5, time_resolution = "DD")
station.trmm.cl5 <- setTimeResolution(station.trmm.cl5, time_resolution = "DD")

station.obs.cl5 <- setGridDates.asPOSIXlt(station.obs.cl5, tz = "UTC")
station.trmm.cl5 <- setGridDates.asPOSIXlt(station.trmm.cl5, tz = "UTC")

cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm", cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7, cross.val = 'loo', wt = T)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st7.wt5 <- scores
```




### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```
```{r}
station.obs <- setGridDates.asPOSIXlt(station.obs, tz = "UTC")
station.trmm <- setGridDates.asPOSIXlt(station.trmm, tz = "UTC")
```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = 'loo')

cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")
cal.station.complete <- setTimeResolution(cal.station.complete, time_resolution = "DD")

cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm", cross.val = 'loo')


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", cross.val = 'loo')


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7, cross.val = 'loo')


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st7.wt1[1]),names(scores.st7.wt2[1]),names(scores.st7.wt3[1]),names(scores.st7.wt4[1]),names(scores.st7.wt5[1]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.pqm <- biasCorrection(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm", cross.val = 'loo', wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.pqm$Dates$start <- as.POSIXct(cal.station.cl1.pqm$Dates$start,tz = "GMT")
cal.station.cl1.pqm$Dates$end <- as.POSIXct(cal.station.cl1.pqm$Dates$end,tz = "GMT")

cal.station.cl2.eqm <- biasCorrection(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm", cross.val = 'loo', wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.eqm$Dates$start <- as.POSIXct(cal.station.cl2.eqm$Dates$start,tz = "GMT")
cal.station.cl2.eqm$Dates$end <- as.POSIXct(cal.station.cl2.eqm$Dates$end,tz = "GMT")

cal.station.cl3.pqm <- biasCorrection(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm", cross.val = "loo", wt = T)


#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.pqm$Dates$start <- as.POSIXct(cal.station.cl3.pqm$Dates$start,tz = "GMT")
cal.station.cl3.pqm$Dates$end <- as.POSIXct(cal.station.cl3.pqm$Dates$end,tz = "GMT")

cal.station.cl4.eqm <- biasCorrection(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.eqm$Dates$start <- as.POSIXct(cal.station.cl4.eqm$Dates$start,tz = "GMT")
cal.station.cl4.eqm$Dates$end <- as.POSIXct(cal.station.cl4.eqm$Dates$end,tz = "GMT")

cal.station.cl5.eqm <- biasCorrection(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm", cross.val = "loo", wt = T)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.eqm$Dates$start <- as.POSIXct(cal.station.cl5.eqm$Dates$start,tz = "GMT")
cal.station.cl5.eqm$Dates$end <- as.POSIXct(cal.station.cl5.eqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.pqm$Data))
cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.eqm$Data))
cal.station.cl2.eqm <- subsetDimension(cal.station.cl2.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.pqm$Data))
cal.station.cl3.pqm <- subsetDimension(cal.station.cl3.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.eqm$Data))
cal.station.cl4.eqm <- subsetDimension(cal.station.cl4.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.eqm$Data))
cal.station.cl5.eqm <- subsetDimension(cal.station.cl5.eqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.pqm, cal.station.cl2.eqm, cal.station.cl3.pqm,
                           cal.station.cl4.eqm, cal.station.cl5.eqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
cal.station.complete <- biasCorrection(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm", cross.val = "loo")

```


```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.pqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.pqm <- c(index.pqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.pqm.rv20max <- MaxReturnValue(cal.station.complete)
index.pqm<- c(index.pqm ,index.pqm.rv20max)

index.pqm

```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.pqm <- abs(index.obs-index.pqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
# score.trmm <- c()
# for (i in c(1:9)) {
#   score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
# }
# score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][1]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][2]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][3]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][4]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][5]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("PQM-C","EQM-C","GPQM-C","GPQM2-C","Combined")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.pqm)

colnames(df) <- c("Observation","Conditioned", "PQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.pqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias PQM")

format(bias.df, digits = 3, scientific = 5)
```

```{r}
df.st1 <- df
bias.df.st1 <- bias.df
```

```{r}
bias.rel.cond <- (abs(df[,2]-df[,1])/df[,1])*100

names(bias.rel.cond) <- names(diff.conditioned)

bias.rel.no.cond <- (abs(df[,3]-df[,1])/df[,1])*100

names(bias.rel.no.cond) <- names(diff.conditioned)
```

```{r}
bias.rel.df <- data.frame(bias.rel.cond, bias.rel.no.cond)

colnames(bias.rel.df) <- c("Relative Bias Conditioned", "Relative Bias PQM")

format(bias.rel.df, digits = 3, scientific = 5)
```


```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,500))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```