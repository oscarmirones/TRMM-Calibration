
---
title: "Assesment of the conditioned calibration"
author: "Óscar Mirones Alonso"
output: 
  html_notebook:
    theme: united
    toc: yes
    toc_depth: 5
---

```{r}
library(loadeR)
library(transformeR)
library(downscaleR)
library(visualizeR)
library(convertR)
library(ncdf4)
library(climate4R.value)
library(magrittr)
library(evd)
library(formattable) #neccessary to create tables with colors
library(lubridate) #neccessary to calculate differences in years between dates
library(lattice)
library(ggplot2)
library(raster)
library(rasterVis)
library(sp)
library(ggplot2)

if (dir.exists("C:/Users/usuario/Desktop/TRMM-Calibration/Data")) {
  dir <- "C:/Users/usuario/Desktop/TRMM-Calibration/Data"
}else{
  dir <- "/vols/abedul/meteo/mironeso/trmm"
}

```

```{r setup}
knitr::opts_knit$set(root.dir = dir)
```

```{r}
biasCorrectionMod <- function(y, x, newdata = NULL, precipitation = FALSE,
                              method = c("delta", "scaling", "eqm", "pqm", "gpqm", "loci","dqm","qdm", "isimip3"),
                              cross.val = c("none", "loo", "kfold"),
                              folds = NULL,
                              consecutive = TRUE,
                              window = NULL,
                              scaling.type = c("additive", "multiplicative"),
                              fitdistr.args = list(densfun = "normal"),
                              wet.threshold = 1,
                              n.quantiles = NULL,
                              extrapolation = c("none", "constant"), 
                              theta = c(.95,.05),
                              detrend = TRUE,
                              isimip3.args = NULL,
                              join.members = FALSE,
                              return.raw = FALSE,
                              interpGrid.args = list(),
                              parallel = FALSE,
                              max.ncores = 16,
                              ncores = NULL) {
  if (method == "gqm") stop("'gqm' is not a valid choice anymore. Use method = 'pqm' instead and set fitdistr.args = list(densfun = 'gamma')")
  method <- match.arg(method, choices = c("delta", "scaling", "eqm", "pqm", "gpqm", "mva", "loci", "ptr", "variance","dqm","qdm", "isimip3"))
  cross.val <- match.arg(cross.val, choices = c("none", "loo", "kfold"))
  scaling.type <- match.arg(scaling.type, choices = c("additive", "multiplicative"))
  extrapolation <- match.arg(extrapolation, choices = c("none", "constant"))
  stopifnot(is.logical(join.members))
  nwdatamssg <- TRUE
  if (is.null(newdata)) {
    newdata <- x 
    nwdatamssg <- FALSE
  }
  # ####temporal solution for applying the isimip method###########
  # if (method == "isimip") {
  #       warning("cross-validation, window and joining member options are not implemented for the isimip method yet.")
  #       suppressMessages(x <- interpGrid(x, getGrid(y)))
  #       suppressMessages(newdata <- interpGrid(newdata, getGrid(y)))
  #       output <- do.call("isimip", list(y = y, x = x, newdata = newdata, threshold = wet.threshold, type = scaling.type))
  # } else {
  # ##################################################
  seas <- getSeason(y)
  fillGridDates <- function(grid, tz = ""){
    station <- ("loc" %in% getDim(grid)) 
    grid <- redim(grid, runtime = TRUE, var = TRUE)
    start <- getRefDates(grid)
    end <- getRefDates(grid, which = "end")
    day.step <- as.numeric(names(which.max(table(difftime(c(start, NA), c(NA, start), units = "days")))))
    message("Time difference of ", day.step, " days")
    formato <- "%Y-%m-%d %H:%M:%S"
    if (day.step >= 1) formato <- "%Y-%m-%d"
    start <- as.POSIXlt(start, format = formato, tz = tz)
    end <- as.POSIXlt(end, format = formato, tz = tz)
    xs <- as.POSIXlt(as.character(seq.POSIXt(start[1], start[length(start)],
                                             by = day.step*24*60*60)),
                     format = formato, tz = tz)
    xe <- as.POSIXlt(as.character(seq.POSIXt(end[1], end[length(end)],
                                             by = day.step*24*60*60)),
                     format = formato, tz = tz)
    end <- NULL
    test <- data.frame("date" = start, "wh" = TRUE)
    start <- NULL
    result <- merge(data.frame("date" = xs), test,
                    by.y = "date", by.x = "date", all.x = TRUE)
    ind <- which(result[, "wh"])
    sh <- getShape(grid)
    sh[names(sh) == "time"] <- nrow(result)
    result <- NULL
    arr <- array(data = NA, dim = sh)
    arr[,,, ind ,,] <- grid[["Data"]] 
    grid[["Data"]] <- arr
    arr <- NULL
    attr(grid[["Data"]], "dimensions") <- names(sh)
    grid[["Dates"]][["start"]] <- strftime(xs, format = formato, tz = tz, usetz = TRUE)
    grid[["Dates"]][["end"]] <- strftime(xe, format = formato, tz = tz, usetz = TRUE)
    xs <- xe <- NULL
    grid <- redim(grid, drop = TRUE, loc = station)
    return(grid)
  }
  y <- fillGridDates(y)
  x <- fillGridDates(x)
  newdata <- fillGridDates(newdata)
  yx <- intersectGrid(y, x, type = "temporal", which.return = 1:2)
  y <- yx[[1]]
  x <- yx[[2]]
  if (cross.val == "none") {
    output <- biasCorrectionXD(y = y, x = x, newdata = newdata, 
                               precipitation = precipitation,
                               method = method,
                               window = window,
                               scaling.type = scaling.type,
                               fitdistr.args = fitdistr.args,
                               pr.threshold = wet.threshold, 
                               n.quantiles = n.quantiles, 
                               extrapolation = extrapolation, 
                               theta = theta,
                               join.members = join.members,
                               detrend = detrend,
                               isimip3.args = isimip3.args,
                               return.raw = return.raw,
                               interpGrid.args = interpGrid.args,
                               parallel = parallel,
                               max.ncores = max.ncores,
                               ncores = ncores)
    output$Data[which(is.infinite(output$Data))] <- NA
  } else {
    if (nwdatamssg) {
      message("'newdata' will be ignored for cross-validation")
    }
    if (cross.val == "loo") {
      years <- as.list(unique(getYearsAsINDEX(x)))
    } else if (cross.val == "kfold" & !is.null(folds)) {
      if (!is.list(folds)) {
        avy <- unique(getYearsAsINDEX(y))
        ind <- rep(1:folds, length(avy)/folds, length.out = length(avy))
        ind <- if (consecutive) {
          sort(ind) 
        } else {
          sample(ind, length(ind))
        }
        folds <- split(avy, f = ind)
      }
      years <- folds
    } else if (cross.val == "kfold" & is.null(folds)) {
      stop("Fold specification is missing, with no default")
    }
    output.list <- lapply(1:length(years), function(i) {
      target.year <- years[[i]]
      rest.years <- setdiff(unlist(years), target.year)
      station <- FALSE
      if ("loc" %in% getDim(y)) station <- TRUE
      yy <- redim(y, member = FALSE)
      yy <- if (method == "delta") {
        subsetGrid(yy, years = target.year, drop = FALSE)
      } else {
        subsetGrid(yy, years = rest.years, drop = FALSE)
      }
      if (isTRUE(station)) {
        yy$Data <- adrop(yy$Data, drop = 3)
        attr(yy$Data, "dimensions") <- c(setdiff(getDim(yy), c("lat", "lon")), "loc")
      } else {
        yy <- redim(yy, drop = TRUE)
      }
      newdata2 <- subsetGrid(x, years = target.year, drop = F)
      xx <- subsetGrid(x, years = rest.years, drop = F)
      message("Validation ", i, ", ", length(unique(years)) - i, " remaining")
      biasCorrectionXD(y = yy, x = xx, newdata = newdata2, precipitation = precipitation,
                       method = method,
                       window = window,
                       scaling.type = scaling.type,
                       fitdistr.args = fitdistr.args,
                       pr.threshold = wet.threshold, n.quantiles = n.quantiles, extrapolation = extrapolation, 
                       theta = theta, join.members = join.members,
                       detrend = detrend,
                       isimip3.args = isimip3.args,
                       return.raw = return.raw,
                       interpGrid.args = interpGrid.args,
                       parallel = parallel,
                       max.ncores = max.ncores,
                       ncores = ncores)
    })
    output <- redim(bindGrid(output.list, dimension = "time"), drop = TRUE)
    # al <- which(getDim(x) == "time")
    # Data <- sapply(output.list, function(n) unname(n$Data), simplify = FALSE)
    # bindata <- unname(do.call("abind", c(Data, along = al)))
    # output <- output.list[[1]]
    # dimNames <- attr(output$Data, "dimensions")
    # output$Data <- bindata
    # attr(output$Data, "dimensions") <- dimNames
    # output$Dates <- x$Dates
    output$Data[which(is.infinite(output$Data))] <- NA
  }
  output <- subsetGrid(output, season = seas)
  return(output)
}

biasCorrectionXD <- function(y, x, newdata, 
                             precipitation, 
                             method,
                             window,
                             scaling.type,
                             fitdistr.args,
                             pr.threshold, 
                             n.quantiles, 
                             extrapolation, 
                             theta,
                             join.members,
                             detrend,
                             isimip3.args,
                             return.raw = FALSE,
                             interpGrid.args = list(),
                             parallel = FALSE,
                             max.ncores = 16,
                             ncores = NULL) {
  if (method == "isimip3") {
    window <- NULL
    # warning("Only parameter isimip3.args is considered")
    if (is.null(isimip3.args)) isimip3.args <- list()
    isimip3.args[["dates"]] <- list(obs_hist = y[["Dates"]][["start"]],
                                    sim_hist = x[["Dates"]][["start"]],
                                    sim_fut = newdata[["Dates"]][["start"]])
  }
  station <- FALSE
  if ("loc" %in% getDim(y)) station <- TRUE
  xy <- y$xyCoords
  # suppressWarnings(suppressMessages(pred <- interpGrid(x, getGrid(y), force.non.overlapping = TRUE)))
  # suppressWarnings(suppressMessages(sim <- interpGrid(newdata, getGrid(y), force.non.overlapping = TRUE)))
  interpGrid.args[["new.coordinates"]] <- getGrid(y)
  interpGrid.args[["grid"]] <- x
  suppressWarnings(suppressMessages(pred <- do.call("interpGrid", interpGrid.args)))
  interpGrid.args[["grid"]] <- newdata
  suppressWarnings(suppressMessages(sim <- do.call("interpGrid", interpGrid.args)))
  delta.method <- method == "delta"
  precip <- precipitation
  message("[", Sys.time(), "] Argument precipitation is set as ", precip, ", please ensure that this matches your data.")
  bc <- y
  if (isTRUE(join.members) & getShape(redim(sim))["member"] > 1) {
    n.mem.aux <- getShape(sim)["member"]
    pred <- flatMemberDim(pred, station)
    pred <- redim(pred, drop = T)
    sim <- flatMemberDim(sim, station)
    sim <- redim(sim, drop = T)
    y <- bindGrid(rep(list(y), n.mem.aux), dimension = "time")
  } else if (isTRUE(join.members) & !getShape(redim(sim))["member"] > 1) {
    warning("There is only one member, argument join.members ignored.")
    join.members <- FALSE
  }
  y <- redim(y, drop = TRUE)
  y <- redim(y, member = FALSE, runtime = FALSE)
  pred <- redim(pred, member = TRUE, runtime = TRUE)
  sim <- redim(sim, member = TRUE, runtime = TRUE)
  dimNames <- attr(y$Data, "dimensions")
  n.run <- getShape(sim)["runtime"]
  n.mem <- getShape(sim)["member"]
  if (join.members & !is.null(window)) {
    message("[", Sys.time(), "] Window option is currently not supported for joined members and will be ignored")
    window <- NULL
  }
  if (!is.null(window)) {
    win <- getWindowIndex(y = y, x = pred, newdata = sim, window = window, delta.method = delta.method)
  } else {
    win <- list()
    indobservations <- match(as.POSIXct(pred$Dates$start), as.POSIXct(y$Dates$start))
    ## esto no mola, es para el caso especial de join members...hay que mirarlo
    if (length(indobservations) > length(unique(indobservations))) indobservations <- 1:length(indobservations) 
    win[["Window1"]] <- list("obsWindow" = indobservations, "window" = 1:getShape(pred)["time"], "step" = 1:getShape(sim)["time"])
    if (delta.method) win[["Window1"]][["deltaind"]] <- indobservations
  }
  message("[", Sys.time(), "] Number of windows considered: ", length(win), "...")
  winarr <- array(dim = dim(sim$Data))
  if (delta.method) winarr <- array(dim = c(n.run, n.mem, getShape(y)))
  for (j in 1:length(win)) {
    yind <- win[[j]]$obsWindow
    outind <- win[[j]]$step
    if (delta.method) {
      yind <- win[[j]]$deltaind
      outind <- win[[j]]$deltaind
    } 
    yw <- y$Data[yind,,, drop = FALSE]
    pw <- pred$Data[,,win[[j]]$window,,, drop = FALSE]
    sw <- sim$Data[,,win[[j]]$step,,, drop = FALSE]
    runarr <- lapply(1:n.run, function(l){
      memarr <- lapply(1:n.mem, function(m){
        #join members message
        if (j == 1 & m == 1) {
          if (!isTRUE(join.members)) {
            message("[", Sys.time(), "] Bias-correcting ", n.mem, " members separately...")
          } else {
            message("[", Sys.time(), "] Bias-correcting ", attr(pred, "orig.mem.shape"), " members considering their joint distribution...")
          }
        }
        o = yw[, , , drop = FALSE]
        p = adrop(pw[l, m, , , , drop = FALSE], drop = c(T, T, F, F, F))
        s = adrop(sw[l, m, , , , drop = FALSE], drop = c(T, T, F, F, F))
        data <- list(o, p, s)
        if (!station) {
          data <- lapply(1:length(data), function(x) {
            attr(data[[x]], "dimensions") <- dimNames
            abind(array3Dto2Dmat(data[[x]]), along = 3)
          }) 
        }
        o <- lapply(seq_len(ncol(data[[1]])), function(i) data[[1]][,i,1])
        p <- lapply(seq_len(ncol(data[[2]])), function(i) data[[2]][,i,1])
        s <- lapply(seq_len(ncol(data[[3]])), function(i) data[[3]][,i,1])
        data <- NULL
        mat <- biasCorrection1D(o, p, s,
                                method = method,
                                scaling.type = scaling.type,
                                fitdistr.args = fitdistr.args,
                                precip = precip,
                                pr.threshold = pr.threshold,
                                n.quantiles = n.quantiles,
                                extrapolation = extrapolation,
                                theta = theta,
                                detrend = detrend,
                                isimip3.args = isimip3.args,
                                parallel = parallel,
                                max.ncores = max.ncores,
                                ncores = ncores)  
        if (!station) mat <- mat2Dto3Darray(mat, xy$x, xy$y)
        mat
      })
      unname(do.call("abind", list(memarr, along = 0)))
    })
    yw <- pw <- sw <- NULL
    winarr[,,outind,,] <- unname(do.call("abind", list(runarr, along = 0))) 
    runarr <- NULL
  }
  bc$Data <- unname(do.call("abind", list(winarr, along = 3)))
  winarr <- NULL
  attr(bc$Data, "dimensions") <- attr(sim$Data, "dimensions")
  if (station) bc <- redim(bc, loc = TRUE)
  bc$Dates <- sim$Dates
  ## Recover the member dimension when join.members=TRUE:
  if (isTRUE(join.members)) {
    if (method == "delta") {
      bc <- recoverMemberDim(plain.grid = pred, bc.grid = bc, newdata = newdata)
    }else{
      bc <- recoverMemberDim(plain.grid = sim, bc.grid = bc, newdata = newdata)      
    }
  } else {
    bc$InitializationDates <- sim$InitializationDates
    bc$Members <- sim$Members
  }
  if (return.raw) {
    sim[["Variable"]][["varName"]] <- paste0(bc[["Variable"]][["varName"]], "_raw")
    bc <- makeMultiGrid(bc, sim)
    if (station){
      bc <- redim(bc, loc = TRUE)
    }
  }
  pred <- newdata <- sim <- y <- NULL
  attr(bc$Variable, "correction") <- method
  bc <- redim(bc, drop = TRUE)
  message("[", Sys.time(), "] Done.")
  return(bc)
}

biasCorrection1D <- function(o, p, s,
                             method, 
                             scaling.type,
                             fitdistr.args,
                             precip, 
                             pr.threshold,
                             n.quantiles,
                             extrapolation, 
                             theta,
                             detrend,
                             isimip3.args,
                             parallel = FALSE,
                             max.ncores = 16,
                             ncores = NULL) {
  parallel.pars <- parallelCheck(parallel, max.ncores, ncores)
  mapply_fun <- selectPar.pplyFun(parallel.pars, .pplyFUN = "mapply")
  if (parallel.pars$hasparallel) on.exit(parallel::stopCluster(parallel.pars$cl))
  if (method == "delta") {
    mapply_fun(delta, o, p, s)
  } else if (method == "scaling") {
    mapply_fun(scaling, o, p, s, MoreArgs = list(scaling.type = scaling.type))
  } else if (method == "eqm") {
    suppressWarnings(
      mapply_fun(eqm, o, p, s, MoreArgs = list(precip, pr.threshold, n.quantiles, extrapolation))
    )
  } else if (method == "pqm") {
    suppressWarnings(
      mapply_fun(pqm, o, p, s, MoreArgs = list(fitdistr.args, precip, pr.threshold))
    )
  } else if (method == "gpqm") {
    mapply_fun(gpqm, o, p, s, MoreArgs = list(precip, pr.threshold, theta))
  } else if (method == "mva") {
    mapply_fun(mva, o, p, s) 
  } else if (method == "variance") {
    mapply_fun(variance, o, p, s, MoreArgs = list(precip))
  } else if (method == "loci") {
    mapply_fun(loci, o, p, s, MoreArgs = list(precip, pr.threshold))
  } else if (method == "ptr") {
    mapply_fun(ptr, o, p, s, MoreArgs = list(precip))
  } else if (method == "dqm") {
    mapply_fun(dqm, o, p, s, MoreArgs = list(precip, pr.threshold, n.quantiles, detrend))
  } else if (method == "qdm") {
    mapply_fun(qdm, o, p, s, MoreArgs = list(precip, pr.threshold, n.quantiles))
  } else if (method == "isimip3") {
    mapply_fun(isimip3, o, p, s, MoreArgs = isimip3.args) #this method is in a separate file
  }
  #INCLUIR AQUI METODOS NUEVOS
}
#' @title adjustPrecipFreq
#' @description Adjusts precipitation frequency in 'p' (prediction) to the observed frequency in 'o'. 
#' It constitutes a preprocess to bias correct precipitation data following ThemeÃl et al. (2012). 
#' @param obs A vector (e.g. station data) containing the observed climate data for the training period
#' @param pred A vector containing the simulated climate by the model for the training period. 
#' @param threshold The minimum value that is considered as a non-zero precipitation. 
#' @importFrom MASS fitdistr
#' @keywords internal
#' @importFrom stats rgamma
#' @author S. Herrera and M. Iturbide
adjustPrecipFreq <- function(obs, pred, threshold){
  o <- obs[!is.na(obs)]
  p <- pred[!is.na(pred)]
  # Number of dry days in 'o' 
  nPo <- sum(as.double(o < threshold))
  # Number of dry days that must be in 'p' to equal precip frequency in 'o'
  nPp <- ceiling(length(p) * nPo / length(o))
  # Index and values of ordered 'p'
  ix <- sort(p, decreasing = FALSE, index.return = TRUE)$ix
  Ps <- sort(p, decreasing = FALSE)
  Pth <- max(Ps[nPp:(nPp + 1)], na.rm = TRUE) # in case nPp == length(Ps)
  # ThemeÃl (Themessl) modification (simulating rain for model dry days) 
  inddrzl <- which(Ps[(nPp + 1):length(Ps)] < threshold)
  if (length(inddrzl) > 0) { 
    Os <- sort(o, decreasing = FALSE, na.last = NA)
    indO <- ceiling(length(Os) * (nPp + max(inddrzl))/length(Ps))
    auxOs <- Os[(nPo + 1):indO]
    if (length(unique(auxOs)) > 6) {
      # simulate precip for 'p' with a gamma adjusted in 'o' for values between
      auxGamma <- fitdistr(auxOs, "gamma")
      Ps[(nPp + 1):(nPp + max(inddrzl))] <- rgamma(length(inddrzl), auxGamma$estimate[1], rate = auxGamma$estimate[2])
    } else {
      Ps[(nPp + 1):(nPp + max(inddrzl))] <- mean(auxOs)
    }
    # order 'Ps' after simulation
    Ps <- sort(Ps, decreasing = FALSE, na.last = NA)
  }
  # Make 0-s
  if (nPo > 0) {
    ind <- min(nPp, length(p))
    Ps[1:ind] <- 0
  }
  p[ix] <- Ps
  pred[!is.na(pred)] <- p
  return(list("nP" = c(nPo,nPp), "Pth" = Pth, "p" = pred)) 
}
#end
#' @title Delta method for bias correction
#' @description Implementation of Delta method for bias correction 
#' @param o A vector (e.g. station data) containing the observed climate data for the training period
#' @param p A vector containing the simulated climate by the model for the training period. 
#' @param s A vector containing the simulated climate for the variable used in \code{x}, but considering the test period.
#' @keywords internal
#' @author S. Herrera and M. Iturbide
delta <- function(o, p, s){
  corrected <- o + (mean(s, na.rm = TRUE) - mean(p, na.rm = TRUE))
  return(corrected)
}
#' @title Scaling method for bias correction
#' @description Implementation of Scaling method for bias correction 
#' @param o A vector (e.g. station data) containing the observed climate data for the training period
#' @param p A vector containing the simulated climate by the model for the training period. 
#' @param s A vector containing the simulated climate for the variable used in \code{x}, but considering the test period.
#' @param scaling.type Character indicating the type of the scaling method. Options are \code{"additive"} (default)
#' or \code{"multiplicative"} (see details). This argument is ignored if \code{"scaling"} is not selected as the bias correction method.
#' @keywords internal
#' @author S. Herrera and M. Iturbide
scaling <- function(o, p, s, scaling.type){
  if (scaling.type == "additive") {
    s - mean(p, na.rm = TRUE) + mean(o, na.rm = TRUE)
  } else if (scaling.type == "multiplicative") {
    (s/mean(p, na.rm = TRUE)) * mean(o, na.rm = TRUE)
  }
}
#' @title Parametric Quantile Mapping method for bias correction
#' @description Implementation of Parametric Quantile Mapping method for bias correction 
#' @param o A vector (e.g. station data) containing the observed climate data for the training period
#' @param p A vector containing the simulated climate by the model for the training period. 
#' @param s A vector containing the simulated climate for the variable used in \code{x}, but considering the test period.
#' @param  fitdistr.args Further arguments passed to function \code{\link[MASS]{fitdistr}} 
#' (\code{densfun}, \code{start}, \code{...}). Only used when applying the "pqm" method 
#' (parametric quantile mapping). Please, read the \code{\link[MASS]{fitdistr}} help 
#' document  carefully before parameter setting in \code{fitdistr.args}.
#' @param precip Logical for precipitation data. If TRUE Adjusts precipitation 
#' frequency in 'x' (prediction) to the observed frequency in 'y'. This is a preprocess to bias correct 
#' precipitation data following ThemeÃl et al. (2012). To adjust the frequency, 
#' parameter \code{pr.threshold} is used (see below).
#' @param pr.threshold The minimum value that is considered as a non-zero precipitation. Ignored when 
#' \code{precip = FALSE}. See details in function \code{biasCorrection}.
#' @importFrom MASS fitdistr
#' @importFrom stats pgamma qgamma 
#' @keywords internal
#' @author S. Herrera and M. Iturbide
pqm <- function(o, p, s, fitdistr.args, precip, pr.threshold){
  dfdistr <- cbind("df" = c( "beta", "cauchy", "chi-squared", "exponential", "f", "gamma", "geometric", "log-normal", "lognormal", "logistic", "negative binomial", "normal", "Poisson", "t", "weibull"),
                   "p" = c("pbeta", "pcauchy", "pchisq", "pexp", "pf", "pgamma", "pegeom", "plnorm", "plnorm", "plogis", "pnbinom", "pnorm", "ppois", "pt", "pweibull"),
                   "q" = c("qbeta", "qcauchy", "qchisq", "qexp", "qf", "qgamma", "qegeom", "qlnorm", "qlnorm", "qlogis", "qnbinom", "qnorm", "qpois", "qt", "qweibull"))
  fitdistr.args <- fitdistr.args[which(names(fitdistr.args) != "x")]
  statsfunp <- unname(dfdistr[which(dfdistr[,"df"] == fitdistr.args$densfun), "p"])
  statsfunq <- unname(dfdistr[which(dfdistr[,"df"] == fitdistr.args$densfun), "q"])
  run <- TRUE
  ind.o <- 1:length(o)
  ind.p <- 1:length(p)
  rain <- 1:length(s)
  if (precip) {
    threshold <- pr.threshold
    if (any(!is.na(o))) {
      params <-  adjustPrecipFreq(o, p, threshold)
      p <- params$p
      nP <- params$nP
      Pth <- params$Pth
    } else {
      nP = NULL
    }
    if (is.null(nP)) {
      run <- FALSE
      s <- rep(NA, length(s))
    } else if (nP[1] < length(o)) {
      ind.o <- which(o > threshold & !is.na(o))
      ind.p <- which(p > 0 & !is.na(p))
      rain <- which(s > Pth & !is.na(s))
      noRain <- which(s <= Pth & !is.na(s))
    } else {
      run <- FALSE
      warning("For the window step selected, location without rainfall above the threshold.\n no bias correction applied in location.")
    } 
  }
  if (all(is.na(o[ind.o]))) {
    run <- FALSE
    s <- rep(NA, length(s))
  }
  if (run) {
    fitdistr.args.o <- c("x" = list(o[ind.o]), fitdistr.args)
    fitdistr.args.p <- c("x" = list(p[ind.p]), fitdistr.args)
    obsGamma <- tryCatch({do.call("fitdistr", fitdistr.args.o)}, error = function(err){NULL})
    prdGamma <- tryCatch({do.call("fitdistr", fitdistr.args.p)}, error = function(err){NULL})
    if (!is.null(prdGamma) & !is.null(obsGamma)) {
      statsfun.args <- c(list(s[rain]), as.list(prdGamma$estimate))
      auxF <- do.call(statsfunp, statsfun.args)
      statsfun.args <- c(list(auxF), as.list(obsGamma$estimate))
      s[rain] <- do.call(statsfunq, statsfun.args)
      if (precip) s[noRain] <- 0
    } else {
      warning("Fitting error for location and selected 'densfun'.")
    }
  }   
  return(s)      
}   
#end
#' @title Empirical Quantile Mapping method for bias correction
#' @description Implementation of Empirical Quantile Mapping method for bias correction 
#' @param o A vector (e.g. station data) containing the observed climate data for the training period
#' @param p A vector containing the simulated climate by the model for the training period. 
#' @param s A vector containing the simulated climate for the variable used in \code{p}, but considering the test period.
#' @param precip Logical for precipitation data. If TRUE Adjusts precipitation 
#' frequency in 'x' (prediction) to the observed frequency in 'y'. This is a preprocess to bias correct 
#' precipitation data following ThemeÃl et al. (2012). To adjust the frequency, 
#' parameter \code{pr.threshold} is used (see below).
#' @param pr.threshold The minimum value that is considered as a non-zero precipitation. Ignored when 
#' \code{precip = FALSE}. See details in function \code{biasCorrection}.
#' @param n.quantiles Integer indicating the number of quantiles to be considered when method = "eqm". Default is NULL, 
#' that considers all quantiles, i.e. \code{n.quantiles = length(p)}.
#' @param extrapolation Character indicating the extrapolation method to be applied to correct values in  
#' \code{"s"} that are out of the range of \code{"p"}. Extrapolation is applied only to the \code{"eqm"} method, 
#' thus, this argument is ignored if other bias correction method is selected. 
#' @keywords internal
#' @importFrom stats approxfun ecdf quantile
#' @author S. Herrera and M. Iturbide
eqm <- function(o, p, s, precip, pr.threshold, n.quantiles, extrapolation){
  if (precip == TRUE) {
    threshold <- pr.threshold
    if (any(!is.na(o))) {
      params <-  adjustPrecipFreq(o, p, threshold)
      p <- params$p
      nP <- params$nP
      Pth <- params$Pth
    } else {
      nP = NULL
    }
    smap <- rep(NA, length(s))
    if (any(!is.na(p)) & any(!is.na(o))) {
      if (length(which(p > Pth)) > 0) { 
        noRain <- which(s <= Pth & !is.na(s))
        rain <- which(s > Pth & !is.na(s))
        drizzle <- which(s > Pth  & s  <= min(p[which(p > Pth)], na.rm = TRUE) & !is.na(s))
        if (length(rain) > 0) {
          eFrc <- tryCatch({ecdf(s[rain])}, error = function(err) {stop("There are not precipitation days in newdata for the step length selected in one or more locations. Try to enlarge the window step")})
          if (is.null(n.quantiles)) n.quantiles <- length(p)
          bins <- n.quantiles
          qo <- quantile(o[which(o > threshold & !is.na(o))], prob = seq(1/bins,1 - 1/bins,1/bins), na.rm = T)
          qp <- quantile(p[which(p > Pth)], prob = seq(1/bins,1 - 1/bins,1/bins), na.rm = T)
          p2o <- tryCatch({approxfun(qp, qo, method = "linear")}, error = function(err) {NA})
          smap <- s
          smap[rain] <- if (suppressWarnings(!is.na(p2o))) {
            p2o(s[rain])
          }else{
            s[rain] <- NA
          }
          # Linear extrapolation was discarded due to lack of robustness 
          if (extrapolation == "constant") {
            smap[rain][which(s[rain] > max(qp, na.rm = TRUE))] <- s[rain][which(s[rain] > max(qp, na.rm = TRUE))] + (qo[length(qo)] - qp[length(qo)])
            smap[rain][which(s[rain] < min(qp, na.rm = TRUE))] <- s[rain][which(s[rain] < min(qp, na.rm = TRUE))] + (qo[1] - qp[1]) 
          } else {
            smap[rain][which(s[rain] > max(qp, na.rm = TRUE))] <- qo[length(qo)]
            smap[rain][which(s[rain] < min(qp, na.rm = TRUE))] <- qo[1]
          }
        }else{
          smap <- rep(0, length(s))
          warning("There are not precipitation days in newdata for the step length selected in one or more locations. Consider the possibility of enlarging the window step")
        }
        if (length(drizzle) > 0) {
          smap[drizzle] <- quantile(s[which(s > min(p[which(p > Pth)], na.rm = TRUE) & !is.na(s))], probs = eFrc(s[drizzle]), na.rm = TRUE, type = 4)
        }
        smap[noRain] <- 0
      } else { ## For dry series
        smap <- s
        warning('No rainy days in the prediction. Bias correction is not applied') 
      }
    }
  } else {
    if (all(is.na(o))) {
      smap <- rep(NA, length(s))
    } else if (all(is.na(p))) {
      smap <- rep(NA, length(s))
    }else if (any(!is.na(p)) & any(!is.na(o))) {
      if (is.null(n.quantiles)) n.quantiles <- length(p)
      bins <- n.quantiles
      qo <- quantile(o, prob = seq(1/bins,1 - 1/bins,1/bins), na.rm = TRUE)
      qp <- quantile(p, prob = seq(1/bins,1 - 1/bins,1/bins), na.rm = TRUE)
      p2o <- approxfun(qp, qo, method = "linear")
      smap <- p2o(s)
      if (extrapolation == "constant") {
        smap[which(s > max(qp, na.rm = TRUE))] <- s[which(s > max(qp, na.rm = TRUE))] + (qo[length(qo)] - qp[length(qo)])
        smap[which(s < min(qp, na.rm = TRUE))] <- s[which(s < min(qp, na.rm = TRUE))] + (qo[1] - qp[1]) 
      } else {
        smap[which(s > max(qp, na.rm = TRUE))] <- qo[length(qo)]
        smap[which(s < min(qp, na.rm = TRUE))] <- qo[1]
      }
    } 
  }
  return(smap)
}
#end
#' @title Generalized Quantile Mapping method for bias correction
#' @description Implementation of Generalized Quantile Mapping method for bias correction 
#' @param o A vector (e.g. station data) containing the observed climate data for the training period
#' @param p A vector containing the simulated climate by the model for the training period. 
#' @param s A vector containing the simulated climate for the variable used in \code{p}, but considering the test period.
#' @param precip Logical for precipitation data. If TRUE Adjusts precipitation 
#' frequency in 'x' (prediction) to the observed frequency in 'y'. This is a preprocess to bias correct 
#' precipitation data following ThemeÃl et al. (2012). To adjust the frequency, 
#' parameter \code{pr.threshold} is used (see below).
#' @param pr.threshold The minimum value that is considered as a non-zero precipitation. Ignored when 
#' \code{precip = FALSE}. See details in function \code{biasCorrection}.
#' @param theta numeric indicating  upper threshold (and lower for the left tail of the distributions, if needed) 
#' above which precipitation (temperature) values are fitted to a Generalized Pareto Distribution (GPD). 
#' Values below this threshold are fitted to a gamma (normal) distribution. By default, 'theta' is the 95th 
#' percentile (5th percentile for the left tail). 
#' @importFrom evd fpot
#' @importFrom MASS fitdistr
#' @importFrom evd qgpd pgpd
#' @importFrom stats quantile pgamma qgamma pnorm qnorm
#' @keywords internal
#' @author S. Herrera and M. Iturbide
gpqm <- function(o, p, s, precip, pr.threshold, theta) { 
  if (precip == FALSE) {
    # stop("method gpqm is only applied to precipitation data")
    # For temperature, lower (values below theta.low) and upper (values above theta) tails of the distribution are fitted with GPD.
    if (all(is.na(o)) | all(is.na(p))) {
      s <- rep(NA, length(s))
    } else{
      theta.low <- theta[2]
      theta <- theta[1]
      ind <- which(!is.na(o))
      indnormal <- ind[which((o[ind] < quantile(o[ind], theta)) & (o[ind] > quantile(o[ind], theta.low)))]
      indparetoUp <- ind[which(o[ind] >= quantile(o[ind], theta))]
      indparetoLow <- ind[which(o[ind] <= quantile(o[ind], theta.low))]
      indp <- which(!is.na(p))
      indnormalp <- indp[which((p[indp] < quantile(p[indp],theta)) & (p[indp] > quantile(p[indp], theta.low)))]
      indparetopUp <- indp[which(p[indp] >= quantile(p[indp], theta))]
      indparetopLow <- indp[which(p[indp] <= quantile(p[indp], theta.low))]
      inds <- which(!is.na(s))
      indnormalsim <- inds[which((s[inds] < quantile(p[indp], theta)) & (s[inds] > quantile(p[indp], theta.low)))]
      indparetosimUp <- inds[which(s[inds] >= quantile(p[indp], theta))]
      indparetosimLow <- inds[which(s[inds] <= quantile(p[indp], theta.low))]
      # normal distribution
      obsGQM <- fitdistr(o[indnormal],"normal")
      prdGQM <- fitdistr(p[indnormalp], "normal")
      auxF <- pnorm(s[indnormalsim], prdGQM$estimate[1], prdGQM$estimate[2])
      s[indnormalsim] <- qnorm(auxF, obsGQM$estimate[1], obsGQM$estimate[2])
      # upper tail
      obsGQM2Up <- fpot(o[indparetoUp], quantile(o[ind], theta), "gpd", std.err = FALSE)
      prdGQM2Up <- fpot(p[indparetopUp], quantile(p[indp], theta), "gpd", std.err = FALSE)
      auxF2Up <- pgpd(s[indparetosimUp], loc = prdGQM2Up$threshold, scale = prdGQM2Up$estimate[1], shape = prdGQM2Up$estimate[2])
      s[indparetosimUp[which(auxF2Up < 1  & auxF2Up > 0)]] <- qgpd(auxF2Up[which(auxF2Up < 1 & auxF2Up > 0)], loc = obsGQM2Up$threshold, scale = obsGQM2Up$estimate[1], shape = obsGQM2Up$estimate[2])
      s[indparetosimUp[which(auxF2Up == 1)]] <- max(o[indparetoUp], na.rm = TRUE)
      s[indparetosimUp[which(auxF2Up == 0)]] <- min(o[indparetoUp], na.rm = TRUE)
      # lower tail
      obsGQM2Low <- fpot(-o[indparetoLow], -quantile(o[ind], theta.low), "gpd", std.err = FALSE)
      prdGQM2Low <- fpot(-p[indparetopLow], -quantile(p[indp], theta.low), "gpd", std.err = FALSE)
      auxF2Low <- pgpd(-s[indparetosimLow], loc = prdGQM2Low$threshold, scale = prdGQM2Low$estimate[1], shape = prdGQM2Low$estimate[2])
      s[indparetosimLow[which(auxF2Low < 1 & auxF2Low > 0)]] <- -qgpd(auxF2Low[which(auxF2Low < 1 & auxF2Low > 0)], loc = obsGQM2Low$threshold, scale = obsGQM2Low$estimate[1], shape = obsGQM2Low$estimate[2])
      s[indparetosimLow[which(auxF2Low == 1)]] <- max(o[indparetoLow], na.rm = TRUE)
      s[indparetosimLow[which(auxF2Low == 0)]] <- min(o[indparetoLow], na.rm = TRUE)
    }  
  } else {
    theta <- theta[1]
    threshold <- pr.threshold
    if (any(!is.na(o)) & any(!is.na(p))) {
      params <-  adjustPrecipFreq(o, p, threshold)
      p <- params$p
      nP <- params$nP
      Pth <- params$Pth
    } else {
      nP = NULL
    }
    if (is.null(nP)) {
      s <- rep(NA, length(s))
    } else if (nP[1] < length(o)) {
      ind <- which(o > threshold & !is.na(o))
      indgamma <- ind[which(o[ind] < quantile(o[ind], theta))]
      indpareto <- ind[which(o[ind] >= quantile(o[ind], theta))]
      indp <- which(p > 0 & !is.na(p))
      indgammap <- indp[which(p[indp] < quantile(p[indp],theta))]
      indparetop <- indp[which(p[indp] >= quantile(p[indp], theta))]
      rain <- which(s > Pth & !is.na(s))
      noRain <- which(s <= Pth & !is.na(s))
      indgammasim <- rain[which(s[rain] < quantile(p[indp], theta))]
      indparetosim <- rain[which(s[rain] >= quantile(p[indp], theta))]
      # gamma distribution
      if(length(indgamma)>1 & length(indgammap)>1 & length(indgammasim)>1){
        obsGQM <- tryCatch(fitdistr(o[indgamma],"gamma"), error = function(err){NULL})
        prdGQM <- tryCatch(fitdistr(p[indgammap], "gamma"), error = function(err){NULL})
        if (!is.null(prdGQM) & !is.null(obsGQM)) {
          auxF <- pgamma(s[indgammasim], prdGQM$estimate[1], rate = prdGQM$estimate[2])
          s[indgammasim] <- qgamma(auxF, obsGQM$estimate[1], rate = obsGQM$estimate[2])
        } else {
          warning("Fitting error for location and selected 'densfun'.")
          s[indgammasim] <- NA
        }
      } else{
        s[indgammasim] <-0
      }
      # upper tail
      if(any(o[indpareto] > quantile(o[ind], theta)) & any(p[indparetop] > quantile(p[indp], theta))){
        obsGQM2 <- fpot(o[indpareto], quantile(o[ind], theta), "gpd", std.err = FALSE)
        prdGQM2 <- fpot(p[indparetop], quantile(p[indp], theta), "gpd", std.err = FALSE)
        auxF2 <- pgpd(s[indparetosim], loc = 0, scale = prdGQM2$estimate[1], shape = prdGQM2$estimate[2])
        s[indparetosim[which(auxF2 < 1  & auxF2 > 0)]] <- qgpd(auxF2[which(auxF2 < 1  & auxF2 > 0)], loc = 0, scale = obsGQM2$estimate[1], shape = obsGQM2$estimate[2])
        s[indparetosim[which(auxF2 == 1)]] <- max(o[indpareto], na.rm = TRUE)
        s[indparetosim[which(auxF2 == 0)]] <- min(o[indpareto], na.rm = TRUE)
      } else {
        s[indparetosim] <- 0
      }
      # dry days
      s[noRain] <- 0
      # inf to NA
      s[is.infinite(s)] <- NA
      s[s>1e3] <- NA
    } else {
      warning("There is at least one location without rainfall above the threshold.\n In this (these) location(s) none bias correction has been applied.")
    }  
  }
  return(s)
}
```

```{r}
set.seed(42)

load("C:/Users/usuario/Desktop/TRMM-Calibration/Data/pca.RData")
#load("/media/meteo/TOURO Mobile/work/TRMM-Calibration/Data/pp_reanalysis.RData")
idx.tp <- which(attributes(pca$tp[[1]])$explained_variance >= .75)[1]
idx.msl <- which(attributes(pca$msl[[1]])$explained_variance >= .9)[1]
idx.diff.msl <- which(attributes(pca$diff_msl[[1]])$explained_variance >= .9)[1]

pca.matrix <- cbind(pca$tp[[1]]$PCs[,1:idx.tp],pca$msl[[1]]$PCs[,1:idx.msl],pca$diff_msl[[1]]$PCs[,1:idx.diff.msl])

k = 5
load('C:/Users/usuario/Desktop/TRMM-Calibration/Data/kmModel5.RData')

precip_obs <- loadStationData("C:/Users/usuario/Desktop/TRMM-Calibration/Data/SP_ascii.zip", var = "precip_obs")
precip_trmm <- loadStationData("C:/Users/usuario/Desktop/TRMM-Calibration/Data/SP_ascii.zip", var = "precip_trmm")

```


```{r}
kmModel5$cluster <- kmModel5$cluster[1:8034]

```

```{r}
MaxReturnValue <- function(data){
  #library(lubridate)
  #nyears <- round(time_length(difftime(cal.madrid.eqm$Dates$end[length(cal.madrid.eqm$Dates$end)], cal.madrid.eqm$Dates$start[1]),"years"))
  nyears <- 20
  data.maxYear <- aggregateGrid(redim(data), aggr.y = list(FUN = "max",na.rm = TRUE))

  data.maxrv <- climatology(data, clim.fun = list(FUN = "mean", na.rm = T))

  auxData <- data.maxYear$Data
  auxData[which(is.infinite(auxData))] <- NA

  if (any(!is.na(auxData))){
      auxGEV <- fgev(auxData)
      if ((auxGEV$estimate[3] - auxGEV$std.err[3] < 0) & (0  < auxGEV$estimate[3] + auxGEV$std.err[3])){
        auxGEV <- fgev(auxData, shape = 0)
        auxRV <- qgev(1-1/nyears, loc = auxGEV$estimate[1], scale = auxGEV$estimate[2], shape = 0)
      }else{
        auxRV <- qgev(1-1/nyears, loc = auxGEV$estimate[1], scale = auxGEV$estimate[2], shape = auxGEV$estimate[3])
      }
      data.maxrv <- as.numeric(auxRV)
      names(data.maxrv) <- paste("RV",nyears,"_max", sep = "")
  }
  return(data.maxrv)
  }
```

```{r}
#pp_reanalysis <- subsetGrid(pp_reanalysis, years = 1998:2019)
```

## Wallis and Futuna


```{r}
i=1

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))

```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl1[i]-index.obs.cl1[i]),abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.trmm, score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st1.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl2[i]-index.obs.cl2[i]),abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

scores <- c(score.trmm,  score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl3[i]-index.obs.cl3[i]),abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.era5 <- c()

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl4[i]-index.obs.cl4[i]),abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm.cl5 <- c()


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)



scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl5[i]-index.obs.cl5[i]),abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt5 <- scores
```




### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7)


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st1.wt1[1]),names(scores.st1.wt2[1]),names(scores.st1.wt3[1]),names(scores.st1.wt4[1]),names(scores.st1.wt5[1]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.pqm <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.pqm$Dates$start <- as.POSIXct(cal.station.cl1.pqm$Dates$start,tz = "GMT")
cal.station.cl1.pqm$Dates$end <- as.POSIXct(cal.station.cl1.pqm$Dates$end,tz = "GMT")

cal.station.cl2.gpqm2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", theta = .7)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.gpqm2$Dates$start <- as.POSIXct(cal.station.cl2.gpqm2$Dates$start,tz = "GMT")
cal.station.cl2.gpqm2$Dates$end <- as.POSIXct(cal.station.cl2.gpqm2$Dates$end,tz = "GMT")

cal.station.cl3.eqm <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.eqm$Dates$start <- as.POSIXct(cal.station.cl3.eqm$Dates$start,tz = "GMT")
cal.station.cl3.eqm$Dates$end <- as.POSIXct(cal.station.cl3.eqm$Dates$end,tz = "GMT")

cal.station.cl4.gpqm2 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", theta = .7)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.gpqm2$Dates$start <- as.POSIXct(cal.station.cl4.gpqm2$Dates$start,tz = "GMT")
cal.station.cl4.gpqm2$Dates$end <- as.POSIXct(cal.station.cl4.gpqm2$Dates$end,tz = "GMT")

cal.station.cl5.pqm <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.pqm$Dates$start <- as.POSIXct(cal.station.cl5.pqm$Dates$start,tz = "GMT")
cal.station.cl5.pqm$Dates$end <- as.POSIXct(cal.station.cl5.pqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.pqm$Data))
cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.gpqm2$Data))
cal.station.cl2.gpqm2 <- subsetDimension(cal.station.cl2.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.eqm$Data))
cal.station.cl3.eqm <- subsetDimension(cal.station.cl3.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.gpqm2$Data))
cal.station.cl4.gpqm2 <- subsetDimension(cal.station.cl4.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.pqm$Data))
cal.station.cl5.pqm <- subsetDimension(cal.station.cl5.pqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.pqm, cal.station.cl2.gpqm2, cal.station.cl3.eqm,
                           cal.station.cl4.gpqm2, cal.station.cl5.pqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")
```

```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.eqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.eqm <- c(index.eqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.eqm.rv20max <- MaxReturnValue(cal.station.complete)

index.eqm<- c(index.eqm ,index.eqm.rv20max)

index.eqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.eqm <- abs(index.obs-index.eqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][6]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C","Combinated")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.cal.station.eqm.complete)

colnames(df) <- c("Observation","Conditioned", "EQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.eqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias EQM")

format(bias.df, digits = 3, scientific = 5)
```
```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,550))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```

## Hakupu, Niue

```{r}
i=2

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))

```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl1[i]-index.obs.cl1[i]),abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.trmm, score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st1.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl2[i]-index.obs.cl2[i]),abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

scores <- c(score.trmm,  score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl3[i]-index.obs.cl3[i]),abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.era5 <- c()

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl4[i]-index.obs.cl4[i]),abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm.cl5 <- c()


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)



scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl5[i]-index.obs.cl5[i]),abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt5 <- scores
```




### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7)


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st1.wt1[1]),names(scores.st1.wt2[1]),names(scores.st1.wt3[1]),names(scores.st1.wt4[1]),names(scores.st1.wt5[1]), names(scores.complete[1]))
```
### Combination of techniques by WT

```{r}
cal.station.cl1.pqm <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.pqm$Dates$start <- as.POSIXct(cal.station.cl1.pqm$Dates$start,tz = "GMT")
cal.station.cl1.pqm$Dates$end <- as.POSIXct(cal.station.cl1.pqm$Dates$end,tz = "GMT")

cal.station.cl2.eqm <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.eqm$Dates$start <- as.POSIXct(cal.station.cl2.eqm$Dates$start,tz = "GMT")
cal.station.cl2.eqm$Dates$end <- as.POSIXct(cal.station.cl2.eqm$Dates$end,tz = "GMT")

cal.station.cl3.eqm <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.eqm$Dates$start <- as.POSIXct(cal.station.cl3.eqm$Dates$start,tz = "GMT")
cal.station.cl3.eqm$Dates$end <- as.POSIXct(cal.station.cl3.eqm$Dates$end,tz = "GMT")

cal.station.cl4.pqm <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.pqm$Dates$start <- as.POSIXct(cal.station.cl4.pqm$Dates$start,tz = "GMT")
cal.station.cl4.pqm$Dates$end <- as.POSIXct(cal.station.cl4.pqm$Dates$end,tz = "GMT")

cal.station.cl5.pqm <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.pqm$Dates$start <- as.POSIXct(cal.station.cl5.pqm$Dates$start,tz = "GMT")
cal.station.cl5.pqm$Dates$end <- as.POSIXct(cal.station.cl5.pqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.pqm$Data))
cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.eqm$Data))
cal.station.cl2.eqm <- subsetDimension(cal.station.cl2.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.eqm$Data))
cal.station.cl3.eqm <- subsetDimension(cal.station.cl3.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.pqm$Data))
cal.station.cl4.pqm <- subsetDimension(cal.station.cl4.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.pqm$Data))
cal.station.cl5.pqm <- subsetDimension(cal.station.cl5.pqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.pqm, cal.station.cl2.eqm, cal.station.cl3.eqm,
                           cal.station.cl4.pqm, cal.station.cl5.pqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")
```

```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.pqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.pqm <- c(index.pqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.pqm.rv20max <- MaxReturnValue(cal.station.complete)

index.pqm<- c(index.pqm ,index.pqm.rv20max)

index.pqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.pqm <- abs(index.obs-index.pqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][6]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C","Combinated")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.cal.station.pqm.complete)

colnames(df) <- c("Observation","Conditioned", "PQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.pqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias PQM")

format(bias.df, digits = 3, scientific = 5)
```
```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,550))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","PQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```

## Rarotonga, Cook Islands

```{r}
i=3

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))

```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl1[i]-index.obs.cl1[i]),abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.trmm, score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st1.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl2[i]-index.obs.cl2[i]),abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

scores <- c(score.trmm,  score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl3[i]-index.obs.cl3[i]),abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.era5 <- c()

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl4[i]-index.obs.cl4[i]),abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm.cl5 <- c()


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)



scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl5[i]-index.obs.cl5[i]),abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt5 <- scores
```

### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7)


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st1.wt1[1]),names(scores.st1.wt2[1]),names(scores.st1.wt3[1]),names(scores.st1.wt4[1]),names(scores.st1.wt5[1]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.pqm <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.pqm$Dates$start <- as.POSIXct(cal.station.cl1.pqm$Dates$start,tz = "GMT")
cal.station.cl1.pqm$Dates$end <- as.POSIXct(cal.station.cl1.pqm$Dates$end,tz = "GMT")

cal.station.cl2.gpqm2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm", theta = .7)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.gpqm2$Dates$start <- as.POSIXct(cal.station.cl2.gpqm2$Dates$start,tz = "GMT")
cal.station.cl2.gpqm2$Dates$end <- as.POSIXct(cal.station.cl2.gpqm2$Dates$end,tz = "GMT")

cal.station.cl3.gpqm2 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm", theta = .7)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.gpqm2$Dates$start <- as.POSIXct(cal.station.cl3.gpqm2$Dates$start,tz = "GMT")
cal.station.cl3.gpqm2$Dates$end <- as.POSIXct(cal.station.cl3.gpqm2$Dates$end,tz = "GMT")

cal.station.cl4.gpqm2 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm", theta = .7)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.gpqm2$Dates$start <- as.POSIXct(cal.station.cl4.gpqm2$Dates$start,tz = "GMT")
cal.station.cl4.gpqm2$Dates$end <- as.POSIXct(cal.station.cl4.gpqm2$Dates$end,tz = "GMT")

cal.station.cl5.pqm <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.pqm$Dates$start <- as.POSIXct(cal.station.cl5.pqm$Dates$start,tz = "GMT")
cal.station.cl5.pqm$Dates$end <- as.POSIXct(cal.station.cl5.pqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.pqm$Data))
cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.gpqm2$Data))
cal.station.cl2.gpqm2 <- subsetDimension(cal.station.cl2.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.gpqm2$Data))
cal.station.cl3.gpqm2 <- subsetDimension(cal.station.cl3.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.gpqm2$Data))
cal.station.cl4.gpqm2 <- subsetDimension(cal.station.cl4.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.pqm$Data))
cal.station.cl5.pqm <- subsetDimension(cal.station.cl5.pqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.pqm, cal.station.cl2.gpqm2, cal.station.cl3.gpqm2,
                           cal.station.cl4.gpqm2, cal.station.cl5.pqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm")
```

```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.gpqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.gpqm <- c(index.gpqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.gpqm.rv20max <- MaxReturnValue(cal.station.complete)

index.gpqm<- c(index.gpqm ,index.gpqm.rv20max)

index.gpqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.gpqm <- abs(index.obs-index.gpqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][6]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C","Combinated")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.cal.station.gpqm.complete)

colnames(df) <- c("Observation","Conditioned", "GPQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.gpqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias GPQM")

format(bias.df, digits = 3, scientific = 5)
```
```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,550))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","GPQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```

## Raoul Island, New Zealand
```{r}
i=4

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))

```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl1[i]-index.obs.cl1[i]),abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.trmm, score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st1.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl2[i]-index.obs.cl2[i]),abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

scores <- c(score.trmm,  score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl3[i]-index.obs.cl3[i]),abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.era5 <- c()

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl4[i]-index.obs.cl4[i]),abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm.cl5 <- c()


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)



scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl5[i]-index.obs.cl5[i]),abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt5 <- scores
```

### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7)


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st1.wt1[1]),names(scores.st1.wt2[1]),names(scores.st1.wt3[1]),names(scores.st1.wt4[1]),names(scores.st1.wt5[1]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.eqm <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.eqm$Dates$start <- as.POSIXct(cal.station.cl1.eqm$Dates$start,tz = "GMT")
cal.station.cl1.eqm$Dates$end <- as.POSIXct(cal.station.cl1.eqm$Dates$end,tz = "GMT")

cal.station.cl2.eqm <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.eqm$Dates$start <- as.POSIXct(cal.station.cl2.eqm$Dates$start,tz = "GMT")
cal.station.cl2.eqm$Dates$end <- as.POSIXct(cal.station.cl2.eqm$Dates$end,tz = "GMT")

cal.station.cl3.eqm <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.eqm$Dates$start <- as.POSIXct(cal.station.cl3.eqm$Dates$start,tz = "GMT")
cal.station.cl3.eqm$Dates$end <- as.POSIXct(cal.station.cl3.eqm$Dates$end,tz = "GMT")

cal.station.cl4.pqm <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.pqm$Dates$start <- as.POSIXct(cal.station.cl4.pqm$Dates$start,tz = "GMT")
cal.station.cl4.pqm$Dates$end <- as.POSIXct(cal.station.cl4.pqm$Dates$end,tz = "GMT")

cal.station.cl5.pqm <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.pqm$Dates$start <- as.POSIXct(cal.station.cl5.pqm$Dates$start,tz = "GMT")
cal.station.cl5.pqm$Dates$end <- as.POSIXct(cal.station.cl5.pqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.eqm$Data))
cal.station.cl1.eqm <- subsetDimension(cal.station.cl1.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.eqm$Data))
cal.station.cl2.eqm <- subsetDimension(cal.station.cl2.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.eqm$Data))
cal.station.cl3.eqm <- subsetDimension(cal.station.cl3.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.pqm$Data))
cal.station.cl4.pqm <- subsetDimension(cal.station.cl4.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.pqm$Data))
cal.station.cl5.pqm <- subsetDimension(cal.station.cl5.pqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.eqm, cal.station.cl2.eqm, cal.station.cl3.eqm,
                           cal.station.cl4.pqm, cal.station.cl5.pqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")
```

```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.eqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.eqm <- c(index.eqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.eqm.rv20max <- MaxReturnValue(cal.station.complete)

index.eqm<- c(index.eqm ,index.eqm.rv20max)

index.eqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.eqm <- abs(index.obs-index.eqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][6]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C","Combinated")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.eqm)

colnames(df) <- c("Observation","Conditioned", "EQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.eqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias EQM")

format(bias.df, digits = 3, scientific = 5)
```

```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,550))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```
## ocean buoy?


```{r}
i=5

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))

```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl1[i]-index.obs.cl1[i]),abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.trmm, score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st1.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl2[i]-index.obs.cl2[i]),abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

scores <- c(score.trmm,  score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl3[i]-index.obs.cl3[i]),abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.era5 <- c()

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl4[i]-index.obs.cl4[i]),abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm.cl5 <- c()


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)



scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl5[i]-index.obs.cl5[i]),abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt5 <- scores
```

### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7)


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st1.wt1[1]),names(scores.st1.wt2[1]),names(scores.st1.wt3[1]),names(scores.st1.wt4[1]),names(scores.st1.wt5[2]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.eqm <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.eqm$Dates$start <- as.POSIXct(cal.station.cl1.eqm$Dates$start,tz = "GMT")
cal.station.cl1.eqm$Dates$end <- as.POSIXct(cal.station.cl1.eqm$Dates$end,tz = "GMT")

cal.station.cl2.eqm <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.eqm$Dates$start <- as.POSIXct(cal.station.cl2.eqm$Dates$start,tz = "GMT")
cal.station.cl2.eqm$Dates$end <- as.POSIXct(cal.station.cl2.eqm$Dates$end,tz = "GMT")

cal.station.cl3.eqm <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.eqm$Dates$start <- as.POSIXct(cal.station.cl3.eqm$Dates$start,tz = "GMT")
cal.station.cl3.eqm$Dates$end <- as.POSIXct(cal.station.cl3.eqm$Dates$end,tz = "GMT")

cal.station.cl4.pqm <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.pqm$Dates$start <- as.POSIXct(cal.station.cl4.pqm$Dates$start,tz = "GMT")
cal.station.cl4.pqm$Dates$end <- as.POSIXct(cal.station.cl4.pqm$Dates$end,tz = "GMT")

cal.station.cl5.pqm <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.pqm$Dates$start <- as.POSIXct(cal.station.cl5.pqm$Dates$start,tz = "GMT")
cal.station.cl5.pqm$Dates$end <- as.POSIXct(cal.station.cl5.pqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.eqm$Data))
cal.station.cl1.eqm <- subsetDimension(cal.station.cl1.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.eqm$Data))
cal.station.cl2.eqm <- subsetDimension(cal.station.cl2.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.eqm$Data))
cal.station.cl3.eqm <- subsetDimension(cal.station.cl3.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.pqm$Data))
cal.station.cl4.pqm <- subsetDimension(cal.station.cl4.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.pqm$Data))
cal.station.cl5.pqm <- subsetDimension(cal.station.cl5.pqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.eqm, cal.station.cl2.eqm, cal.station.cl3.eqm,
                           cal.station.cl4.pqm, cal.station.cl5.pqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")
```

```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.eqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.eqm <- c(index.eqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.eqm.rv20max <- MaxReturnValue(cal.station.complete)

index.eqm<- c(index.eqm ,index.eqm.rv20max)

index.eqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.eqm <- abs(index.obs-index.eqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][6]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C","Combinated")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.eqm)

colnames(df) <- c("Observation","Conditioned", "EQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.eqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias EQM")

format(bias.df, digits = 3, scientific = 5)
```
```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,550))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","EQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```

## Aoloau, American Samoa

```{r}
i=6

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))

```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl1[i]-index.obs.cl1[i]),abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.trmm, score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st1.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl2[i]-index.obs.cl2[i]),abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

scores <- c(score.trmm,  score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl3[i]-index.obs.cl3[i]),abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.era5 <- c()

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl4[i]-index.obs.cl4[i]),abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm.cl5 <- c()


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)



scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl5[i]-index.obs.cl5[i]),abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt5 <- scores
```

### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7)


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st1.wt1[1]),names(scores.st1.wt2[1]),names(scores.st1.wt3[1]),names(scores.st1.wt4[1]),names(scores.st1.wt5[1]), names(scores.complete[1]))
```

### Combination of techniques by WT

```{r}
cal.station.cl1.gpqm2 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm", theta = .7)

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.gpqm2$Dates$start <- as.POSIXct(cal.station.cl1.gpqm2$Dates$start,tz = "GMT")
cal.station.cl1.gpqm2$Dates$end <- as.POSIXct(cal.station.cl1.gpqm2$Dates$end,tz = "GMT")

cal.station.cl2.pqm <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.pqm$Dates$start <- as.POSIXct(cal.station.cl2.pqm$Dates$start,tz = "GMT")
cal.station.cl2.pqm$Dates$end <- as.POSIXct(cal.station.cl2.pqm$Dates$end,tz = "GMT")

cal.station.cl3.eqm <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.eqm$Dates$start <- as.POSIXct(cal.station.cl3.eqm$Dates$start,tz = "GMT")
cal.station.cl3.eqm$Dates$end <- as.POSIXct(cal.station.cl3.eqm$Dates$end,tz = "GMT")

cal.station.cl4.eqm <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.eqm$Dates$start <- as.POSIXct(cal.station.cl4.eqm$Dates$start,tz = "GMT")
cal.station.cl4.eqm$Dates$end <- as.POSIXct(cal.station.cl4.eqm$Dates$end,tz = "GMT")

cal.station.cl5.pqm <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.pqm$Dates$start <- as.POSIXct(cal.station.cl5.pqm$Dates$start,tz = "GMT")
cal.station.cl5.pqm$Dates$end <- as.POSIXct(cal.station.cl5.pqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.gpqm2$Data))
cal.station.cl1.gpqm2 <- subsetDimension(cal.station.cl1.gpqm2, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.pqm$Data))
cal.station.cl2.pqm <- subsetDimension(cal.station.cl2.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.eqm$Data))
cal.station.cl3.eqm <- subsetDimension(cal.station.cl3.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.eqm$Data))
cal.station.cl4.eqm <- subsetDimension(cal.station.cl4.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.pqm$Data))
cal.station.cl5.pqm <- subsetDimension(cal.station.cl5.pqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.gpqm2, cal.station.cl2.pqm, cal.station.cl3.eqm,
                           cal.station.cl4.eqm, cal.station.cl5.pqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")
```

```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.pqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.pqm <- c(index.pqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.pqm.rv20max <- MaxReturnValue(cal.station.complete)

index.pqm<- c(index.pqm ,index.pqm.rv20max)

index.pqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.pqm <- abs(index.obs-index.pqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][6]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C","Combinated")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.cal.station.pqm.complete)

colnames(df) <- c("Observation","Conditioned", "PQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.pqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias PQM")

format(bias.df, digits = 3, scientific = 5)
```
```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,550))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","PQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```

## Aoloau, American Samoa (low elevation)

```{r}
i=7

station.trmm <- subsetGrid(precip_trmm, station.id = precip_trmm$Metadata$station_id[i])
station.obs <- subsetGrid(precip_obs, station.id = precip_trmm$Metadata$station_id[i])
```


````{r}
index.obs <- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs <- c(index.obs, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.rv20max <- MaxReturnValue(station.obs)
index.obs <- c(index.obs, index.obs.rv20max)

index.trmm <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.rv20max <- MaxReturnValue(station.trmm)
index.trmm <- c(index.trmm, index.trmm.rv20max)


```



### WT1

```{r}
station.obs.cl1 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 1))


station.trmm.cl1 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 1))

```

```{r}
index.obs.cl1 <- valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl1 <- c(index.obs.cl1, valueIndex1D(station.obs.cl1$Data[!is.na(station.obs.cl1$Data)], index.codes = "P98WetAmount"))
index.obs.cl1.rv20max <- MaxReturnValue(station.obs.cl1)
index.obs.cl1 <- c(index.obs.cl1, index.obs.cl1.rv20max)

index.trmm.cl1 <- valueIndex1D(station.trmm.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl1.rv20max <- MaxReturnValue(station.trmm.cl1)
index.trmm.cl1 <- c(index.trmm.cl1, index.trmm.cl1.rv20max)
```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.pqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "eqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.eqm.cl1 <- index.cal.station.cl1


```

```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm")


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm.cl1 <- index.cal.station.cl1


```


```{r}
cal.station.cl1 <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl1 <- subsetDimension(cal.station.cl1, dimension = "time", indices = which(!is.na(cal.station.cl1$Data)))

cal.station.cl1$Dates$start <- as.POSIXct(cal.station.cl1$Dates$start,tz = "GMT")
cal.station.cl1$Dates$end <- as.POSIXct(cal.station.cl1$Dates$end,tz = "GMT")

index.cal.station.cl1 <- valueIndex1D(cal.station.cl1$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl1 <- c(index.cal.station.cl1, valueIndex1D(cal.station.cl1$Data[!is.na(cal.station.cl1$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl1.rv20max <- MaxReturnValue(cal.station.cl1)

index.cal.station.cl1 <- c(index.cal.station.cl1, index.cal.station.cl1.rv20max)

index.cal.station.gpqm2.cl1 <- index.cal.station.cl1


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl1[i]-index.obs.cl1[i]),abs(index.cal.station.pqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.eqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm.cl1[i]-index.obs.cl1[i]), abs(index.cal.station.gpqm2.cl1[i]-index.obs.cl1[i])) 
}

```

```{r}
normalization <- function(measure){
  measure.norm <- c()
  #measure must be a vector with the value of a certain measure of different calibrations
  for (i in c(1:length(measure))) {
    measure.norm <- c(measure.norm, 1-((measure[i]-min(measure))/(max(measure)-min(measure))))
  }
  return(measure.norm)
}
```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)




scores <- c(score.trmm, score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
```
```{r}
scores.st1.wt1 <- scores
```

### WT2
```{r}
station.obs.cl2 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 2))


station.trmm.cl2 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 2))

```

```{r}
index.obs.cl2 <- valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl2 <- c(index.obs.cl2, valueIndex1D(station.obs.cl2$Data[!is.na(station.obs.cl2$Data)], index.codes = "P98WetAmount"))
index.obs.cl2.rv20max <- MaxReturnValue(station.obs.cl2)
index.obs.cl2 <- c(index.obs.cl2, index.obs.cl2.rv20max)

index.trmm.cl2 <- valueIndex1D(station.trmm.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl2.rv20max <- MaxReturnValue(station.trmm.cl2)
index.trmm.cl2 <- c(index.trmm.cl2, index.trmm.cl2.rv20max)

```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "pqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.pqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.eqm.cl2 <- index.cal.station.cl2


```

```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm")


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm.cl2 <- index.cal.station.cl2


```


```{r}
cal.station.cl2 <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl2 <- subsetDimension(cal.station.cl2, dimension = "time", indices = which(!is.na(cal.station.cl2$Data)))

cal.station.cl2$Dates$start <- as.POSIXct(cal.station.cl2$Dates$start,tz = "GMT")
cal.station.cl2$Dates$end <- as.POSIXct(cal.station.cl2$Dates$end,tz = "GMT")

index.cal.station.cl2 <- valueIndex1D(cal.station.cl2$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl2 <- c(index.cal.station.cl2, valueIndex1D(cal.station.cl2$Data[!is.na(cal.station.cl2$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl2.rv20max <- MaxReturnValue(cal.station.cl2)

index.cal.station.cl2 <- c(index.cal.station.cl2, index.cal.station.cl2.rv20max)

index.cal.station.gpqm2.cl2 <- index.cal.station.cl2


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl2[i]-index.obs.cl2[i]),abs(index.cal.station.pqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.eqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm.cl2[i]-index.obs.cl2[i]), abs(index.cal.station.gpqm2.cl2[i]-index.obs.cl2[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

scores <- c(score.trmm,  score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT1","EQM-WT1","GPQM-WT1","GPQM2-WT1")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt2 <- scores
```

### WT3

```{r}
station.obs.cl3 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 3))


station.trmm.cl3 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 3))

```

```{r}
index.obs.cl3 <- valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl3 <- c(index.obs.cl3, valueIndex1D(station.obs.cl3$Data[!is.na(station.obs.cl3$Data)], index.codes = "P98WetAmount"))
index.obs.cl3.rv20max <- MaxReturnValue(station.obs.cl3)
index.obs.cl3 <- c(index.obs.cl3, index.obs.cl3.rv20max)

index.trmm.cl3 <- valueIndex1D(station.trmm.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl3.rv20max <- MaxReturnValue(station.trmm.cl3)
index.trmm.cl3 <- c(index.trmm.cl3, index.trmm.cl3.rv20max)

```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.pqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "eqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.eqm.cl3 <- index.cal.station.cl3


```

```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm")


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm.cl3 <- index.cal.station.cl3


```


```{r}
cal.station.cl3 <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl3 <- subsetDimension(cal.station.cl3, dimension = "time", indices = which(!is.na(cal.station.cl3$Data)))

cal.station.cl3$Dates$start <- as.POSIXct(cal.station.cl3$Dates$start,tz = "GMT")
cal.station.cl3$Dates$end <- as.POSIXct(cal.station.cl3$Dates$end,tz = "GMT")

index.cal.station.cl3 <- valueIndex1D(cal.station.cl3$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl3 <- c(index.cal.station.cl3, valueIndex1D(cal.station.cl3$Data[!is.na(cal.station.cl3$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl3.rv20max <- MaxReturnValue(cal.station.cl3)

index.cal.station.cl3 <- c(index.cal.station.cl3, index.cal.station.cl3.rv20max)

index.cal.station.gpqm2.cl3 <- index.cal.station.cl3


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl3[i]-index.obs.cl3[i]),abs(index.cal.station.pqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.eqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm.cl3[i]-index.obs.cl3[i]), abs(index.cal.station.gpqm2.cl3[i]-index.obs.cl3[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.era5 <- c()

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT3","EQM-WT3","GPQM-WT3","GPQM2-WT3")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt3 <- scores
```
### WT4

```{r}
station.obs.cl4 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 4))


station.trmm.cl4 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 4))

```

```{r}
index.obs.cl4 <- valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl4 <- c(index.obs.cl4, valueIndex1D(station.obs.cl4$Data[!is.na(station.obs.cl4$Data)], index.codes = "P98WetAmount"))
index.obs.cl4.rv20max <- MaxReturnValue(station.obs.cl4)
index.obs.cl4 <- c(index.obs.cl4, index.obs.cl4.rv20max)

index.trmm.cl4 <- valueIndex1D(station.trmm.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl4.rv20max <- MaxReturnValue(station.trmm.cl4)
index.trmm.cl4 <- c(index.trmm.cl4, index.trmm.cl4.rv20max)


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "pqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.pqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.eqm.cl4 <- index.cal.station.cl4


```

```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm")


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm.cl4 <- index.cal.station.cl4


```


```{r}
cal.station.cl4 <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl4 <- subsetDimension(cal.station.cl4, dimension = "time", indices = which(!is.na(cal.station.cl4$Data)))

cal.station.cl4$Dates$start <- as.POSIXct(cal.station.cl4$Dates$start,tz = "GMT")
cal.station.cl4$Dates$end <- as.POSIXct(cal.station.cl4$Dates$end,tz = "GMT")

index.cal.station.cl4 <- valueIndex1D(cal.station.cl4$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl4 <- c(index.cal.station.cl4, valueIndex1D(cal.station.cl4$Data[!is.na(cal.station.cl4$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl4.rv20max <- MaxReturnValue(cal.station.cl4)

index.cal.station.cl4 <- c(index.cal.station.cl4, index.cal.station.cl4.rv20max)

index.cal.station.gpqm2.cl4 <- index.cal.station.cl4


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl4[i]-index.obs.cl4[i]),abs(index.cal.station.pqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.eqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm.cl4[i]-index.obs.cl4[i]), abs(index.cal.station.gpqm2.cl4[i]-index.obs.cl4[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)

score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)

score.gpqm.cl5 <- c()


score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)



scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT4","EQM-WT4","GPQM-WT4","GPQM2-WT4")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt4 <- scores
```
### WT5

```{r}
station.obs.cl5 <- subsetDimension(station.obs, dimension = "time", indices = which(kmModel5$cluster == 5))


station.trmm.cl5 <- subsetDimension(station.trmm, dimension = "time", indices = which(kmModel5$cluster == 5))

```

```{r}
index.obs.cl5 <- valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.cl5 <- c(index.obs.cl5, valueIndex1D(station.obs.cl5$Data[!is.na(station.obs.cl5$Data)], index.codes = "P98WetAmount"))
index.obs.cl5.rv20max <- MaxReturnValue(station.obs.cl5)
index.obs.cl5 <- c(index.obs.cl5, index.obs.cl5.rv20max)

index.trmm.cl5 <- valueIndex1D(station.trmm.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.cl5.rv20max <- MaxReturnValue(station.trmm.cl5)
index.trmm.cl5 <- c(index.trmm.cl5, index.trmm.cl5.rv20max)
```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "pqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.pqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.eqm.cl5 <- index.cal.station.cl5


```

```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm")


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm.cl5 <- index.cal.station.cl5


```


```{r}
cal.station.cl5 <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "gpqm" , theta = .7)


cal.station.cl5 <- subsetDimension(cal.station.cl5, dimension = "time", indices = which(!is.na(cal.station.cl5$Data)))

cal.station.cl5$Dates$start <- as.POSIXct(cal.station.cl5$Dates$start,tz = "GMT")
cal.station.cl5$Dates$end <- as.POSIXct(cal.station.cl5$Dates$end,tz = "GMT")

index.cal.station.cl5 <- valueIndex1D(cal.station.cl5$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.cl5 <- c(index.cal.station.cl5, valueIndex1D(cal.station.cl5$Data[!is.na(cal.station.cl5$Data)], index.codes = "P98WetAmount"))

index.cal.station.cl5.rv20max <- MaxReturnValue(cal.station.cl5)

index.cal.station.cl5 <- c(index.cal.station.cl5, index.cal.station.cl5.rv20max)

index.cal.station.gpqm2.cl5 <- index.cal.station.cl5


```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.cl5[i]-index.obs.cl5[i]),abs(index.cal.station.pqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.eqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm.cl5[i]-index.obs.cl5[i]), abs(index.cal.station.gpqm2.cl5[i]-index.obs.cl5[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-WT5","EQM-WT5","GPQM-WT5","GPQM2-WT5")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.st1.wt5 <- scores
```

### Complete period (WO WTs)



```{r}
index.obs.complete<- valueIndex1D(station.obs$Data[!is.na(station.obs$Data)],index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))
index.obs.complete<- c(index.obs.complete, valueIndex1D(station.obs$Data[!is.na(station.obs$Data)], index.codes = "P98WetAmount"))
index.obs.complete.rv20max <- MaxReturnValue(station.obs)
index.obs.complete <- c(index.obs.complete, index.obs.complete.rv20max)

index.trmm.complete <- valueIndex1D(station.trmm$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet","P98WetAmount"))
index.trmm.complete.rv20max <- MaxReturnValue(station.trmm)
index.trmm.complete <- c(index.trmm.complete, index.trmm.complete.rv20max)
```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.pqm.complete <- index.cal.station.complete


```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "eqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.eqm.complete <- index.cal.station.complete


```

```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm")


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm.complete <- index.cal.station.complete



```


```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "gpqm", theta = .7)


cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(cal.station.complete$Data)))

cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.cal.station.complete <- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.cal.station.complete <- c(index.cal.station.complete, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.cal.station.complete.rv20max <- MaxReturnValue(cal.station.complete)

index.cal.station.complete <- c(index.cal.station.complete, index.cal.station.complete.rv20max)

index.cal.station.gpqm2.complete <- index.cal.station.complete



```



```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)


scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
scores.complete <- scores
```

```{r}
paste(names(scores.st1.wt1[1]),names(scores.st1.wt2[1]),names(scores.st1.wt3[1]),names(scores.st1.wt4[1]),names(scores.st1.wt5[1]), names(scores.complete[1]))
```
### Combination of techniques by WT

```{r}
cal.station.cl1.pqm <- biasCorrectionMod(y = station.obs.cl1, x = station.trmm.cl1, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl1.pqm$Dates$start <- as.POSIXct(cal.station.cl1.pqm$Dates$start,tz = "GMT")
cal.station.cl1.pqm$Dates$end <- as.POSIXct(cal.station.cl1.pqm$Dates$end,tz = "GMT")

cal.station.cl2.eqm <- biasCorrectionMod(y = station.obs.cl2, x = station.trmm.cl2, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl2.eqm$Dates$start <- as.POSIXct(cal.station.cl2.eqm$Dates$start,tz = "GMT")
cal.station.cl2.eqm$Dates$end <- as.POSIXct(cal.station.cl2.eqm$Dates$end,tz = "GMT")

cal.station.cl3.pqm <- biasCorrectionMod(y = station.obs.cl3, x = station.trmm.cl3, precipitation = TRUE,  method = "pqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl3.pqm$Dates$start <- as.POSIXct(cal.station.cl3.pqm$Dates$start,tz = "GMT")
cal.station.cl3.pqm$Dates$end <- as.POSIXct(cal.station.cl3.pqm$Dates$end,tz = "GMT")

cal.station.cl4.eqm <- biasCorrectionMod(y = station.obs.cl4, x = station.trmm.cl4, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl4.eqm$Dates$start <- as.POSIXct(cal.station.cl4.eqm$Dates$start,tz = "GMT")
cal.station.cl4.eqm$Dates$end <- as.POSIXct(cal.station.cl4.eqm$Dates$end,tz = "GMT")

cal.station.cl5.eqm <- biasCorrectionMod(y = station.obs.cl5, x = station.trmm.cl5, precipitation = TRUE,  method = "eqm")

#cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = which(!is.na(cal.station.cl1.pqm$Data)))

cal.station.cl5.eqm$Dates$start <- as.POSIXct(cal.station.cl5.eqm$Dates$start,tz = "GMT")
cal.station.cl5.eqm$Dates$end <- as.POSIXct(cal.station.cl5.eqm$Dates$end,tz = "GMT")


idx <- which(!is.na(cal.station.cl1.pqm$Data))
cal.station.cl1.pqm <- subsetDimension(cal.station.cl1.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl2.eqm$Data))
cal.station.cl2.eqm <- subsetDimension(cal.station.cl2.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl3.pqm$Data))
cal.station.cl3.pqm <- subsetDimension(cal.station.cl3.pqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl4.eqm$Data))
cal.station.cl4.eqm <- subsetDimension(cal.station.cl4.eqm, dimension = "time", indices = idx)

idx <- which(!is.na(cal.station.cl5.eqm$Data))
cal.station.cl5.eqm <- subsetDimension(cal.station.cl5.eqm, dimension = "time", indices = idx)


wt_conditioned <- bindGrid(cal.station.cl1.pqm, cal.station.cl2.eqm, cal.station.cl3.pqm,
                           cal.station.cl4.eqm, cal.station.cl5.eqm, dimension = "time")

attr(wt_conditioned$Data, "dimensions") <- "time"
```
```{r}
cal.station.complete <- biasCorrectionMod(y = station.obs, x = station.trmm, precipitation = TRUE,  method = "pqm")
```

```{r}

# cal.station.complete$Dates$start <- as.POSIXct(cal.station.complete$Dates$start,tz = "GMT")
# cal.station.complete$Dates$end <- as.POSIXct(cal.station.complete$Dates$end,tz = "GMT")

index.combinated <- valueIndex1D(wt_conditioned$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.combinated <- c(index.combinated, valueIndex1D(wt_conditioned$Data[!is.na(wt_conditioned$Data)], index.codes = "P98WetAmount"))

index.combinated.rv20max <- MaxReturnValue(wt_conditioned)

index.combinated <- c(index.combinated, index.combinated.rv20max)

```

```{r}
index.pqm<- valueIndex1D(cal.station.complete$Data,index.codes=c("Skewness","SDII","R10","R10p","R20","R20p","P98Wet"))

index.pqm <- c(index.pqm, valueIndex1D(cal.station.complete$Data[!is.na(cal.station.complete$Data)], index.codes = "P98WetAmount"))

index.pqm.rv20max <- MaxReturnValue(cal.station.complete)

index.pqm<- c(index.pqm ,index.pqm.rv20max)

index.pqm
```
```{r}
diff.conditioned <- abs(index.obs-index.combinated)

diff.pqm <- abs(index.obs-index.pqm)
```


```{r}
measures <- list()
for (i in c(1:9)) {
  measures[[length(measures)+1]] <- c(abs(index.trmm.complete[i]-index.obs.complete[i]),abs(index.cal.station.pqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.eqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm.complete[i]-index.obs.complete[i]), abs(index.cal.station.gpqm2.complete[i]-index.obs.complete[i]), abs(index.combinated[i]-index.obs.complete[i])) 
}

```

```{r}
norm.vector <- list()
for (i in c(1:length(measures))) {
  norm.vector[[length(norm.vector)+1]] <- normalization(measures[[i]]) 
}
```

```{r}
score.trmm <- c()
for (i in c(1:9)) {
  score.trmm <- c(score.trmm, norm.vector[[i]][1]) 
}
score.trmm <- mean(score.trmm)


score.pqm <- c()
for (i in c(1:9)) {
  score.pqm <- c(score.pqm, norm.vector[[i]][2]) 
}
score.pqm <- mean(score.pqm)


score.eqm <- c()
for (i in c(1:9)) {
  score.eqm <- c(score.eqm, norm.vector[[i]][3]) 
}
score.eqm <- mean(score.eqm)


score.gpqm <- c()
for (i in c(1:9)) {
  score.gpqm <- c(score.gpqm, norm.vector[[i]][4]) 
}
score.gpqm <- mean(score.gpqm)



score.gpqm2 <- c()
for (i in c(1:9)) {
  score.gpqm2 <- c(score.gpqm2, norm.vector[[i]][5]) 
}
score.gpqm2 <- mean(score.gpqm2)

score.combinated <- c()
for (i in c(1:9)) {
  score.combinated <- c(score.combinated, norm.vector[[i]][6]) 
}
score.combinated <- mean(score.combinated)

scores <- c(score.trmm,score.pqm, score.eqm, score.gpqm, score.gpqm2, score.combinated)
names(scores) <- c("TRMM","PQM-C","EQM-C","GPQM-C","GPQM2-C","Combinated")
scores <- sort(scores, decreasing = T)
scores
```
```{r}
df <- data.frame(index.obs, index.combinated, index.pqm)

colnames(df) <- c("Observation","Conditioned", "PQM")

format(df, digits = 3, scientific = 5)
```
```{r}
bias.df <- data.frame(diff.conditioned, diff.pqm)

colnames(bias.df) <- c("Bias Conditioned", "Bias PQM")

format(bias.df, digits = 3, scientific = 5)
```

```{r}
qqplot(station.obs$Data, wt_conditioned$Data, main = paste(station.obs$Metadata$name), xlab = "Observed (mm)", ylab = "Predicted (mm)", col = "black", pch = 2, cex = .5, ylim = c(0,550))

abline(a = 0, b = 1)

station.trmm <- subsetDimension(station.trmm, dimension = "time", indices = which(!is.na(station.obs$Data)))

points(sort(station.obs$Data), sort(station.trmm$Data), col = "red", pch = 4, cex = .5)
# points(sort(station.obs$Data[!is.na(station.obs$Data)]), sort(station.trmm$Data[!is.na(station.obs$Data)][-1]), col = "red", pch = 4, cex = .5)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = which(!is.na(station.obs$Data)))

idx <- intersect(which(!is.na(cal.station.complete$Data)),which(!is.na(station.obs$Data)))

station.obs <- subsetDimension(station.obs, dimension = "time", indices = idx)
cal.station.complete <- subsetDimension(cal.station.complete, dimension = "time", indices = idx)

points(sort(station.obs$Data), sort(cal.station.complete$Data), col = "blue", pch = 4, cex = .5)

legend("topleft", legend = c("Combinated","TRMM","PQM"), pch = c(2,4,4), col = c("black", "red","blue"))

grid() 
```